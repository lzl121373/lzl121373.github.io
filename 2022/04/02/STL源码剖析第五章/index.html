<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>&lt;STLæºç å‰–æ&gt;ç¬¬äº”ç« â€”â€”å…³è”å¼å®¹å™¨ | ğŸ˜Š</title><meta name="keywords" content="STL,STLæºç å‰–æ,å®¹å™¨,å…³è”å¼å®¹å™¨,äºŒå‰æœç´¢æ ‘,RB-tree,set,map,multiset,multimap,hashtable"><meta name="author" content="lzl121373"><meta name="copyright" content="lzl121373"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ç¬¬äº”ç« è¯»ä¹¦ç¬”è®°ï¼Œå…³äºå…³è”å¼å®¹å™¨çš„æºç å‰–æ">
<meta property="og:type" content="article">
<meta property="og:title" content="&lt;STLæºç å‰–æ&gt;ç¬¬äº”ç« â€”â€”å…³è”å¼å®¹å™¨">
<meta property="og:url" content="http://example.com/2022/04/02/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%BA%94%E7%AB%A0/index.html">
<meta property="og:site_name" content="ğŸ˜Š">
<meta property="og:description" content="ç¬¬äº”ç« è¯»ä¹¦ç¬”è®°ï¼Œå…³äºå…³è”å¼å®¹å™¨çš„æºç å‰–æ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg">
<meta property="article:published_time" content="2022-04-01T16:00:00.000Z">
<meta property="article:modified_time" content="2022-04-07T16:00:00.000Z">
<meta property="article:author" content="lzl121373">
<meta property="article:tag" content="STL">
<meta property="article:tag" content="STLæºç å‰–æ">
<meta property="article:tag" content="å®¹å™¨">
<meta property="article:tag" content="å…³è”å¼å®¹å™¨">
<meta property="article:tag" content="äºŒå‰æœç´¢æ ‘">
<meta property="article:tag" content="RB-tree">
<meta property="article:tag" content="set">
<meta property="article:tag" content="map">
<meta property="article:tag" content="multiset">
<meta property="article:tag" content="multimap">
<meta property="article:tag" content="hashtable">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/04/02/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%BA%94%E7%AB%A0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '<STLæºç å‰–æ>ç¬¬äº”ç« â€”â€”å…³è”å¼å®¹å™¨',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-04-08 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-images"></i><span> Photo</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ğŸ˜Š</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-images"></i><span> Photo</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">&lt;STLæºç å‰–æ&gt;ç¬¬äº”ç« â€”â€”å…³è”å¼å®¹å™¨</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-04-01T16:00:00.000Z" title="å‘è¡¨äº 2022-04-02 00:00:00">2022-04-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-04-07T16:00:00.000Z" title="æ›´æ–°äº 2022-04-08 00:00:00">2022-04-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">STLæºç å‰–æè¯»ä¹¦ç¬”è®°</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">9.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>40åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="&lt;STLæºç å‰–æ&gt;ç¬¬äº”ç« â€”â€”å…³è”å¼å®¹å™¨"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><p><img src="/../img/%E5%AE%B9%E5%99%A8.png" alt="å®¹å™¨"></p>
<p>å®¹å™¨å°†è¿ç”¨æœ€å¹¿çš„ä¸€äº›æ•°æ®ç»“æ„å®ç°å‡ºæ¥ã€‚è¿™é‡Œçš„è¡ç”Ÿä¸æ˜¯inheritanceå…³ç³»ï¼Œè€Œæ˜¯containmentå…³ç³»ï¼Œä¾‹å¦‚ï¼šheapå†…å«ä¸€ä¸ªvectorï¼Œpriority-queueå†…å«ä¸€ä¸ªheapã€‚</p>
<h2 id="å…³è”å¼å®¹å™¨"><a href="#å…³è”å¼å®¹å™¨" class="headerlink" title="å…³è”å¼å®¹å™¨"></a>å…³è”å¼å®¹å™¨</h2><p>æ‰€è°“å…³è”å¼å®¹å™¨ï¼Œè§‚å¿µä¸Šç±»ä¼¼å…³è”å¼æ•°æ®åº“ï¼ˆå®é™…ä¸Šåˆ™ç®€å•è®¸å¤šï¼‰ï¼šæ¯ç¬”æ•°æ®ï¼ˆæ¯ä¸ªå…ƒç´ ï¼‰éƒ½æœ‰ä¸€ä¸ªé”®å€¼ï¼ˆkeyï¼‰å’Œä¸€ä¸ªå®å€¼ï¼ˆvalueï¼‰ã€‚å½“å…ƒç´ è¢«æ’äººåˆ°å…³è”å¼å®¹å™¨ä¸­æ—¶ï¼Œå®¹å™¨å†…éƒ¨ç»“æ„ï¼ˆå¯èƒ½æ˜¯RB-treeï¼Œä¹Ÿå¯èƒ½æ˜¯hash-tableï¼‰ä¾¿ä¾ç…§å…¶é”®å€¼å¤§å°ï¼Œä»¥æŸç§ç‰¹å®šè§„åˆ™å°†è¿™ä¸ªå…ƒç´ æ”¾ç½®äºé€‚å½“ä½ç½®ã€‚å…³è”å¼å®¹å™¨æ²¡æœ‰æ‰€è°“å¤´å°¾ï¼ˆåªæœ‰æœ€å¤§å…ƒç´ å’Œæœ€å°å…ƒç´ ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰æ‰€è°“push_back()ã€push_front()ã€pop_back()ã€pop_front()ã€begin()ã€ end()è¿™æ ·çš„æ“ä½œè¡Œä¸ºã€‚</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œå…³è”å¼å®¹å™¨çš„å†…éƒ¨ç»“æ„æ˜¯ä¸€ä¸ªbalanced binary tree(å¹³è¡¡äºŒå‰æ ‘)ï¼Œä»¥ä¾¿è·å¾—è‰¯å¥½çš„æœå¯»æ•ˆç‡ã€‚balanced binary treeæœ‰è®¸å¤šç§ç±»å‹ï¼ŒåŒ…æ‹¬AVL-treeã€RB-treeã€AA-treeï¼Œå…¶ä¸­æœ€å¹¿æ³›è¢«è¿ç”¨äºSTLçš„æ˜¯RB-treeã€‚</p>
<h3 id="äºŒå‰æœç´¢æ ‘ï¼ˆbinary-search-treeï¼‰"><a href="#äºŒå‰æœç´¢æ ‘ï¼ˆbinary-search-treeï¼‰" class="headerlink" title="äºŒå‰æœç´¢æ ‘ï¼ˆbinary search treeï¼‰"></a>äºŒå‰æœç´¢æ ‘ï¼ˆbinary search treeï¼‰</h3><p>äºŒå‰æœç´¢æ ‘å¯æä¾›å¯¹æ•°æ—¶é—´çš„å…ƒç´ æ’å…¥å’Œè®¿é—®ï¼ŒäºŒå‰æœç´¢æ ‘çš„èŠ‚ç‚¹æ”¾ç½®è§„åˆ™æ˜¯ï¼šä»»ä½•èŠ‚ç‚¹çš„é”®å€¼ä¸€å®šå¤§äºå…¶å·¦å­æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„é”®å€¼ï¼Œå¹¶å°äºå…¶å³å­æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„é”®å€¼ã€‚å› æ­¤ï¼Œä»æ ¹èŠ‚ç‚¹ä¸€ç›´å¾€å·¦èµ°ï¼Œç›´è‡³æ— å·¦è·¯å¯èµ°ï¼Œå³å¾—åˆ°æœ€å°å…ƒç´ ï¼›ä»æ ¹èŠ‚ç‚¹ä¸€ç›´å¾€å³èµ°ï¼Œç›´è‡³æ— å³è·¯å¯èµ°ï¼Œå³å¾—æœ€å¤§å…ƒç´ ã€‚</p>
<p><img src="/../img/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91.png" alt="äºŒå‰æœç´¢æ ‘"></p>
<h3 id="å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆbalanced-binary-search-treeï¼‰"><a href="#å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆbalanced-binary-search-treeï¼‰" class="headerlink" title="å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆbalanced binary search treeï¼‰"></a>å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆbalanced binary search treeï¼‰</h3><p>äºŒå‰æœç´¢æ ‘å¯èƒ½ä¼šå› ä¸ºè¾“å…¥å€¼ä¸å¤Ÿéšæœºæˆ–è€…ä¸€äº›æ’å…¥åˆ é™¤æ“ä½œçš„åŸå› å¤±å»å¹³è¡¡ï¼Œé€ æˆæœå¯»æ•ˆç‡ä½çš„æƒ…å†µã€‚</p>
<p><img src="/../img/%E4%B8%8D%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png" alt="ä¸å¹³è¡¡äºŒå‰æ ‘"></p>
<p>â€œå¹³è¡¡â€çš„å¤§è‡´æ„ä¹‰æ˜¯ï¼šæ²¡æœ‰ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿‡æ·±ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç»å¯¹çš„è¡¡é‡æ ‡å‡†ï¼Œå› æ­¤ï¼Œå‡ºç°äº†ä¸åŒçš„å¹³è¡¡æ¡ä»¶é€ å°±çš„æ•°ç§ç‰¹æ®Šç»“æ„å¦‚AVL-treeã€RB-treeã€AA-treeï¼Œä»–ä»¬éƒ½æ¯”ä¸€èˆ¬çš„äºŒå‰æœç´¢æ ‘å¤æ‚ï¼Œå› æ­¤ï¼Œæ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çš„å¹³å‡æ—¶é—´æ›´é•¿ï¼Œä½†æ˜¯å¯ä»¥é¿å…ä¸å¹³è¡¡çš„æƒ…å†µè€Œå®ç°æ›´å°‘çš„å…ƒç´ å¹³å‡è®¿é—®æ—¶é—´ã€‚</p>
<h3 id="AVL-tree"><a href="#AVL-tree" class="headerlink" title="AVL tree"></a>AVL tree</h3><p>AVL-treeè¦æ±‚ä»»ä½•èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ç›¸å·®æœ€å¤š1ï¼Œè™½ç„¶è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘æœ‰ç€ç›¸åŒçš„é«˜åº¦æ˜¯ç›´è§‚ä¸Šçš„æœ€ä½³å¹³è¡¡æ¡ä»¶ï¼Œä½†è¿™æ ·å¤ªè¿‡è‹›åˆ»ä»¥è‡³äºéš¾ä»¥åœ¨æ’å…¥æ–°å…ƒç´ æ—¶åˆä¿æŒç€è¿™ç§å¹³è¡¡çŠ¶æ€ã€‚</p>
<p>AVL-treeçš„å¹³è¡¡ç­–ç•¥æ˜¯ï¼šè°ƒæ•´â€œæ’å…¥ç‚¹è‡³æ ¹èŠ‚ç‚¹â€è·¯å¾„ä¸Šï¼Œå¹³è¡¡çŠ¶æ€è¢«ç ´åä¹‹å„èŠ‚ç‚¹ä¸­æœ€æ·±çš„é‚£ä¸€ä¸ªï¼Œä½¿æ•´æ£µæ ‘é‡æ–°è·å¾—å¹³è¡¡ã€‚å‡è®¾è¯¥æœ€æ·±èŠ‚ç‚¹ä¸ºXï¼Œâ€œå¹³è¡¡ç ´åâ€æ„å‘³ç€Xçš„å·¦å³ä¸¤é¢—å­æ ‘çš„é«˜åº¦ç›¸å·®2ï¼Œå¯ä»¥å°†æƒ…å†µåˆ†ä¸ºå››ç§ï¼š</p>
<ol>
<li>æ’äººç‚¹ä½äºXçš„å·¦å­èŠ‚ç‚¹çš„å·¦å­æ ‘â€”â€”å·¦å·¦ã€‚</li>
<li>æ’äººç‚¹ä½äºXçš„å·¦å­èŠ‚ç‚¹çš„å³å­æ ‘â€”â€”å·¦å³ã€‚</li>
<li>æ’äººç‚¹ä½äºXçš„å³å­èŠ‚ç‚¹çš„å·¦å­æ ‘â€”â€”å³å·¦ã€‚</li>
<li>æ’å…¥ç‚¹ä½äºXçš„å³å­èŠ‚ç‚¹çš„å³å­æ ‘â€”â€”å³å³ã€‚</li>
</ol>
<p>æƒ…å†µ1ï¼Œ4ç§°ä¸ºå¤–ä¾§æ’å…¥ï¼Œå¯ä»¥ç”¨å•æ—‹æ“ä½œè°ƒæ•´ï¼›æƒ…å†µ2ï¼Œ3ç§°ä¸ºå†…ä¾§æ’å…¥ï¼Œå¯ä»¥é‡‡ç”¨åŒæ—‹æ“ä½œè°ƒæ•´ã€‚</p>
<p><img src="/../img/AVL-tree%E7%A0%B4%E5%9D%8F%E5%B9%B3%E8%A1%A1.png" alt="AVL-treeç ´åå¹³è¡¡"></p>
<h4 id="å•æ—‹è½¬"><a href="#å•æ—‹è½¬" class="headerlink" title="å•æ—‹è½¬"></a>å•æ—‹è½¬</h4><p><img src="/../img/%E5%8D%95%E6%97%8B%E8%BD%AC.png" alt="å•æ—‹è½¬"></p>
<p>é€šè¿‡k1ä¸Šæï¼Œk2ä¸‹æ»‘æ¥è·å¾—å¹³è¡¡ï¼ˆä»¥k1ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼‰ã€‚</p>
<h4 id="åŒæ—‹è½¬"><a href="#åŒæ—‹è½¬" class="headerlink" title="åŒæ—‹è½¬"></a>åŒæ—‹è½¬</h4><p><img src="/../img/%E5%8F%8C%E6%97%8B%E8%BD%AC.png" alt="åŒæ—‹è½¬"></p>
<p>ä»¥k2ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹æ¥è·å¾—å¹³è¡¡ã€‚</p>
<p>å¯æ‹†è§£ä¸ºä¸¤æ¬¡å•å¾ªç¯ï¼š</p>
<p><img src="/../img/%E5%8F%8C%E5%BE%AA%E7%8E%AF%E6%8B%86%E8%A7%A3.png" alt="åŒå¾ªç¯æ‹†è§£"></p>
<h3 id="RB-treeï¼ˆçº¢é»‘æ ‘ï¼‰"><a href="#RB-treeï¼ˆçº¢é»‘æ ‘ï¼‰" class="headerlink" title="RB-treeï¼ˆçº¢é»‘æ ‘ï¼‰"></a>RB-treeï¼ˆçº¢é»‘æ ‘ï¼‰</h3><p>AVL-treeä¹‹å¤–ï¼Œå¦ä¸€ä¸ªå¹³è¡¡äºŒå‰æœç´¢æ ‘æ˜¯RB-treeï¼ˆçº¢é»‘æ ‘ï¼‰ï¼Œçº¢é»‘æ ‘ä¸ä»…æ˜¯ä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼Œè¿˜å¿…é¡»æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ol>
<li>æ¯ä¸ªèŠ‚ç‚¹ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²ï¼ˆå›¾ä¸­æ·±è‰²åº•çº¹ä»£è¡¨é»‘è‰²ï¼Œæµ…è‰²åº•çº¹ä»£è¡¨çº¢è‰²ï¼Œä¸‹åŒ)ã€‚</li>
<li>æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²ã€‚</li>
<li>å¦‚æœèŠ‚ç‚¹ä¸ºçº¢ï¼Œå…¶å­èŠ‚ç‚¹å¿…é¡»ä¸ºé»‘ã€‚</li>
<li>ä»»ä¸€èŠ‚ç‚¹è‡³ NULLï¼ˆæ ‘å°¾ç«¯ï¼‰çš„ä»»ä½•è·¯å¾„ï¼Œæ‰€å«ä¹‹é»‘èŠ‚ç‚¹æ•°å¿…é¡»ç›¸åŒã€‚</li>
</ol>
<p>æ ¹æ®è§„åˆ™4ï¼Œæ–°å¢èŠ‚ç‚¹å¿…é¡»ä¸ºçº¢ï¼Œæ ¹æ®è§„åˆ™3ï¼Œæ–°å¢èŠ‚ç‚¹ä¹‹çˆ¶èŠ‚ç‚¹å¿…é¡»ä¸ºé»‘ã€‚</p>
<p><img src="/../img/%E7%BA%A2%E9%BB%91%E6%A0%91.png" alt="çº¢é»‘æ ‘"></p>
<h4 id="æ’å…¥èŠ‚ç‚¹"><a href="#æ’å…¥èŠ‚ç‚¹" class="headerlink" title="æ’å…¥èŠ‚ç‚¹"></a>æ’å…¥èŠ‚ç‚¹</h4><p>å‡è®¾æ–°èŠ‚ç‚¹ä¸ºXï¼Œå…¶çˆ¶èŠ‚ç‚¹ä¸ºPï¼Œç¥–çˆ¶èŠ‚ç‚¹ä¸ºGï¼Œçˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ä¸ºSï¼Œæ›¾ç¥–çˆ¶èŠ‚ç‚¹ä¸ºGGã€‚</p>
<p>é¦–å…ˆï¼ŒäºŒå‰æœç´¢æ ‘çš„æ–°å¢èŠ‚ç‚¹å¿…ä¸ºå¶èŠ‚ç‚¹ï¼Œå› æ­¤ï¼ŒXèŠ‚ç‚¹å¿…ä¸ºå¶èŠ‚ç‚¹å³å¿…æ˜¯çº¢è‰²ï¼Œå¦‚æœæ­¤æ—¶PèŠ‚ç‚¹ä¹Ÿä¸ºçº¢è‰²ï¼Œå°±è¿åäº†è§„åˆ™ï¼Œæ­¤æ—¶Gå¿…ä¸ºé»‘ï¼Œäºæ˜¯æ’å…¥èŠ‚ç‚¹åéœ€è°ƒæ•´çš„æƒ…å†µå¯æ ¹æ®Xæ’å…¥ä½ç½®ä»¥åŠSå’ŒGGçš„é¢œè‰²åˆ†ä¸ºå››ç±»ï¼š</p>
<ol>
<li>Sä¸ºé»‘ä¸”Xä¸ºå¤–ä¾§æ’å…¥ã€‚æ­¤æ—¶ï¼Œå…ˆå¯¹Pï¼ŒGåšä¸€æ¬¡å•æ—‹è½¬ï¼Œå†æ›´æ”¹P,Gé¢œè‰²ã€‚</li>
</ol>
<p><img src="/../img/S%E9%BB%91%E5%A4%96%E6%8F%92.png" alt="Sé»‘å¤–æ’"></p>
<ol start="2">
<li>Sä¸ºé»‘ä¸”Xä¸ºå†…ä¾§æ’å…¥ã€‚æ­¤æ—¶ï¼Œåšä¸€æ¬¡åŒæ—‹è½¬ï¼ˆå…ˆå¯¹Pï¼ŒXåšä¸€æ¬¡å•æ—‹è½¬ä¸”æ›´æ”¹Gï¼ŒXé¢œè‰²ï¼Œå†å¯¹Gåšä¸€æ¬¡å•æ—‹è½¬ï¼‰ã€‚</li>
</ol>
<p><img src="/../img/S%E9%BB%91%E5%86%85%E6%8F%92.png" alt="Sé»‘å†…æ’"></p>
<ol start="3">
<li>Sä¸ºçº¢ä¸”Xä¸ºå¤–ä¾§æ’å…¥ã€‚æ­¤æ—¶ï¼Œå…ˆå¯¹Pï¼ŒGåšä¸€æ¬¡å•æ—‹è½¬ï¼Œå¹¶æ”¹å˜Xçš„é¢œè‰²ï¼Œæ­¤æ—¶å¦‚æœGGä¸ºé»‘ï¼Œåˆ™æå®šã€‚</li>
</ol>
<p><img src="/../img/S%E7%BA%A2%E5%A4%96%E6%8F%92GG%E9%BB%91.png" alt="Sçº¢å¤–æ’GGé»‘"></p>
<ol start="4">
<li>Sä¸ºçº¢ä¸”Xä¸ºå¤–ä¾§æ’å…¥ï¼Œæ­¤æ—¶ï¼Œå…ˆå¯¹Pï¼ŒGåšä¸€æ¬¡å•æ—‹è½¬ï¼Œå¹¶æ”¹å˜Xçš„é¢œè‰²ï¼Œæ­¤æ—¶å¦‚æœGGä¸ºçº¢ï¼Œåˆ™ä¸åº”è¯¥è¿™æ ·åšï¼Œè€Œæ˜¯åº”è¯¥å…ˆå®è¡Œä¸€ä¸ªç”±ä¸Šè€Œä¸‹çš„ç¨‹åºï¼šå‡è®¾æ–°å¢èŠ‚ç‚¹ä¸ºAï¼Œé‚£ä¹ˆå°±æ²¿ç€Açš„è·¯å¾„ï¼Œåªè¦çœ‹åˆ°æœ‰æŸèŠ‚ç‚¹Xçš„ä¸¤ä¸ªå­èŠ‚ç‚¹çš†ä¸ºçº¢è‰²ï¼Œå°±æŠŠXæ”¹ä¸ºçº¢è‰²ï¼Œå¹¶æŠŠä¸¤ä¸ªå­èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰²ï¼Œå¦‚æœXçš„çˆ¶èŠ‚ç‚¹Pä»¥ä¸ºçº¢è‰²ï¼Œå°±å¾—åƒçŠ¶å†µ1åšä¸€æ¬¡å•æ—‹è½¬å¹¶æ”¹å˜é¢œè‰²æˆ–æ˜¯åƒçŠ¶å†µ2åšä¸€æ¬¡åŒæ—‹è½¬å¹¶æ”¹å˜é¢œè‰²ã€‚ç¨‹åºç»“æŸåå†æ’å…¥å°±å¾ˆç®€å•äº†ã€‚</li>
</ol>
<h4 id="RB-treeèŠ‚ç‚¹è®¾è®¡"><a href="#RB-treeèŠ‚ç‚¹è®¾è®¡" class="headerlink" title="RB-treeèŠ‚ç‚¹è®¾è®¡"></a>RB-treeèŠ‚ç‚¹è®¾è®¡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">bool</span> __rb_tree_color_type;</span><br><span class="line"><span class="type">const</span> __rb_tree_color_type __rb_tree_red = <span class="literal">false</span>; <span class="comment">//çº¢è‰²ä¸º0</span></span><br><span class="line"><span class="type">const</span> __rb_tree_color_type __rb_tree_black = <span class="literal">true</span>; <span class="comment">//é»‘è‰²ä¸º1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__rb_tree_node_base</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_color_type color_type;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_node_base* base_ptr;</span><br><span class="line"></span><br><span class="line">	color_type color;  <span class="comment">//èŠ‚ç‚¹é¢œè‰²ï¼Œéçº¢å³é»‘	</span></span><br><span class="line">	base_ptr parent;   <span class="comment">//RBæ ‘çš„è®¸å¤šæ“ä½œï¼Œå¿…é¡»çŸ¥é“çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">	base_ptr left;     <span class="comment">//æŒ‡å‘å·¦èŠ‚ç‚¹</span></span><br><span class="line">	base_ptr right;    <span class="comment">//æŒ‡å‘å³èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> base_ptr <span class="title">mininum</span><span class="params">(base_ptr x)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (x-&gt;left != <span class="number">0</span>) x = x-&gt;left;   <span class="comment">//ä¸€ç›´å‘å·¦èµ°ï¼Œå°±ä¼šæ‰¾åˆ°æœ€å°å€¼,</span></span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> base_ptr <span class="title">maximum</span><span class="params">(base_ptr x)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (x-&gt;right != <span class="number">0</span>) x = x-&gt;right; <span class="comment">//ä¸€ç›´å‘å³èµ°ï¼Œå°±ä¼šæ‰¾åˆ°æœ€å¤§,</span></span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__rb_tree_node</span> : <span class="keyword">public</span> __rb_tree_node_base</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_node&lt;Value&gt;* link_type;</span><br><span class="line">	Value value_field;   <span class="comment">//èŠ‚ç‚¹å€¼</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="RB-treeçš„è¿­ä»£å™¨"><a href="#RB-treeçš„è¿­ä»£å™¨" class="headerlink" title="RB-treeçš„è¿­ä»£å™¨"></a>RB-treeçš„è¿­ä»£å™¨</h4><p>RB-treeçš„èŠ‚ç‚¹å’Œè¿­ä»£å™¨ï¼ˆBidirectional Iteratorï¼‰ç»“æ„è®¾è®¡å’Œslistç±»ä¼¼ï¼Œä¸ºä¸¤å±‚ç»“æ„ï¼š</p>
<p><img src="/../img/RB-tree%E8%8A%82%E7%82%B9%E5%92%8C%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%BB%93%E6%9E%84.png" alt="RB-treeèŠ‚ç‚¹å’Œè¿­ä»£å™¨ç»“æ„"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŸºå±‚è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__rb_tree_base_iterator</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_node_base::base_ptr base_ptr;</span><br><span class="line">	<span class="keyword">typedef</span> bidirectional_iterator_tag iterator_category;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="type">ptrdiff_t</span> difference_type;</span><br><span class="line"></span><br><span class="line">	base_ptr node; <span class="comment">// å®ƒç”¨æ¥ä¸å®¹å™¨ä¹‹é—´äº§ç”Ÿä¸€ä¸ªè¿ç»“å…³ç³»(make a reference)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä»¥ä¸‹å…¶å®å¯å®ç°äºoperator++å†…ï¼Œå› ä¸ºå†æ— ä»–å¤„ä¼šè°ƒç”¨æ­¤å‡½æ•°äº†</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (node-&gt;right != <span class="number">0</span>) &#123;			<span class="comment">//å¦‚æœæœ‰å³å­èŠ‚ç‚¹ã€‚çŠ¶å†µ(1)</span></span><br><span class="line">			node = node-&gt;right;         <span class="comment">//å°±å‘å³èµ°</span></span><br><span class="line">			<span class="keyword">while</span> (node-&gt;left != <span class="number">0</span>ï¼‰    <span class="comment">//ç„¶åä¸€ç›´å¾€å·¦å­æ ‘èµ°åˆ°åº•</span></span><br><span class="line">				node = node-&gt;left;      <span class="comment">//å³æ˜¯è§£ç­”</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;                           <span class="comment">//æ²¡æœ‰å³å­èŠ‚ç‚¹ã€‚çŠ¶å†µ(2)</span></span><br><span class="line">			base_ptr y = node-&gt;parent;   <span class="comment">//æ‰¾å‡ºçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">			<span class="keyword">while</span> (node == y-&gt;right) &#123;   <span class="comment">//å¦‚æœç°è¡ŒèŠ‚ç‚¹æœ¬èº«æ˜¯ä¸ªå³å­èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">				node = y;                <span class="comment">//å°±ä¸€ç›´ä¸Šæº¯ï¼Œç›´åˆ°â€œä¸ä¸ºå³å­èŠ‚ç‚¹â€æ­¢</span></span><br><span class="line">				y = y-&gt;parent;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;right != y)        <span class="comment">//è‹¥æ­¤æ—¶çš„å³å­èŠ‚ç‚¹ä¸ç­‰äºæ­¤æ—¶çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">				node = y;                <span class="comment">//çŠ¶å†µ(3)æ­¤æ—¶çš„çˆ¶èŠ‚ç‚¹å³ä¸ºè§£ç­”</span></span><br><span class="line">           							    <span class="comment">//å¦åˆ™æ­¤æ—¶çš„nodeä¸ºè§£ç­”ã€‚çŠ¶å†µ(4)</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//æ³¨æ„ï¼Œä»¥ä¸Šåˆ¤æ–­â€œè‹¥æ­¤æ—¶çš„å³å­èŠ‚ç‚¹ä¸ç­‰äºæ­¤æ—¶çš„çˆ¶èŠ‚ç‚¹â€ï¼Œæ˜¯ä¸ºäº†åº”ä»˜ä¸€ç§</span></span><br><span class="line">		<span class="comment">//ç‰¹æ®Šæƒ…å†µ:æˆ‘ä»¬æ¬²å¯»æ‰¾æ ¹èŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹ï¼Œè€Œæ°å·§æ ¹èŠ‚ç‚¹æ— å³å­èŠ‚ç‚¹</span></span><br><span class="line">		<span class="comment">//å½“ç„¶ï¼Œä»¥ä¸Šç‰¹æ®Šåšæ³•å¿…é¡»é…åˆRB-tree æ ¹èŠ‚ç‚¹ä¸ç‰¹æ®Šä¹‹headerä¹‹é—´çš„</span></span><br><span class="line">		<span class="comment">//ç‰¹æ®Šå…³ç³»</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//ä»¥ä¸‹å…¶å®å¯å®ç°äºoperator--å†…ï¼Œå› ä¸ºå†æ— ä»–å¤„ä¼šè°ƒç”¨æ­¤å‡½æ•°äº†</span></span><br><span class="line">	<span class="type">void</span> <span class="built_in">decrement</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (node-&gt;color == __rb_tree_red &amp;&amp; <span class="comment">//å¦‚æœæ˜¯çº¢èŠ‚ç‚¹ï¼Œä¸”</span></span><br><span class="line">			node-&gt;parent-&gt;parent == node)   <span class="comment">//çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ç­‰äºè‡ªå·±ï¼Œ</span></span><br><span class="line">			node = node-&gt;right;             <span class="comment">//çŠ¶å†µ(1)å³å­èŠ‚ç‚¹å³ä¸ºè§£ç­”</span></span><br><span class="line">		<span class="comment">//ä»¥ä¸Šæƒ…å†µå‘ç”Ÿäºnodeä¸ºheaderæ—¶(äº¦å³nodeä¸ºend()æ—¶)</span></span><br><span class="line">		<span class="comment">//æ³¨æ„ï¼Œheaderä¹‹å³å­èŠ‚ç‚¹å³mostrightï¼ŒæŒ‡å‘æ•´æ£µæ ‘çš„maxèŠ‚ç‚¹</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (node-&gt;left != <span class="number">0</span>) &#123;         <span class="comment">//å¦‚æœæœ‰å·¦å­èŠ‚ç‚¹ã€‚çŠ¶å†µ(2)</span></span><br><span class="line">			base_ptr y = node-&gt;left;        <span class="comment">//ä»¤yæŒ‡å‘å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">			<span class="keyword">while</span> (y-&gt;right ! = <span class="number">0</span>)          <span class="comment">//å½“yæœ‰å³å­èŠ‚ç‚¹æ—¶</span></span><br><span class="line">				y = y-&gt;right;              <span class="comment">//ä¸€ç›´å¾€å³å­èŠ‚ç‚¹èµ°åˆ°åº•</span></span><br><span class="line">			node = y;                      <span class="comment">//æœ€åå³ä¸ºç­”æ¡ˆ</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;                             <span class="comment">//æ—¢éæ ¹èŠ‚ç‚¹ï¼Œäº¦æ— å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">			base_ptr y = node-&gt;parent;     <span class="comment">//çŠ¶å†µ(3ï¼‰æ‰¾å‡ºçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">			<span class="keyword">while</span> (node == y-&gt;left) &#123;      <span class="comment">//å½“ç°è¡ŒèŠ‚ç‚¹èº«ä¸ºå·¦å­èŠ‚ç‚¹</span></span><br><span class="line">				node = y;                  <span class="comment">//ä¸€ç›´äº¤æ›¿å¾€ä¸Šèµ°ï¼Œç›´åˆ°ç°è¡ŒèŠ‚ç‚¹</span></span><br><span class="line">				y = y-&gt;parent;             <span class="comment">//ä¸ä¸ºå·¦å­èŠ‚ç‚¹</span></span><br><span class="line">			&#125;</span><br><span class="line">			node = y;				      <span class="comment">//æ­¤æ—¶ä¹‹çˆ¶èŠ‚ç‚¹å³ä¸ºç­”æ¡ˆ</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;           </span><br><span class="line"></span><br><span class="line"><span class="comment">//RB-treeçš„æ­£è§„è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Value, <span class="keyword">class</span> Ref, <span class="keyword">class</span> Ptr&gt;</span><br><span class="line"><span class="keyword">struct</span> __rb_tree_iterator : <span class="keyword">public</span> __rb_tree_base_iterator</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">typedef</span> Value value_type;</span><br><span class="line">	<span class="keyword">typedef</span> Ref reference;</span><br><span class="line">	<span class="keyword">typedef</span> Ptr pointer;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_iterator&lt;Value, Value&amp;, Value*&gt; iterator;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_iterator&lt;Value, <span class="type">const</span> Value&amp;, <span class="type">const</span> value*&gt; const_iterator;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_iterator&lt;Value, Ref, Ptr&gt; self;</span><br><span class="line">	<span class="keyword">typedef</span> __rb_tree_node&lt;Value&gt;*    link_type;</span><br><span class="line"></span><br><span class="line">	__rb_tree_iterator() &#123; &#125;</span><br><span class="line">	__rb_tree_iterator(link_type x) &#123; node = x; &#125;</span><br><span class="line">	__rb_tree_iterator(<span class="type">const</span> iterator&amp; it) &#123; node = it.node; &#125;</span><br><span class="line">	</span><br><span class="line">	reference <span class="keyword">operator</span>*() <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">link_type</span>(node) -&gt; value_field; &#125;</span><br><span class="line">	<span class="meta">#<span class="keyword">ifndef</span> __SGI_STL_NO_ARROW_OPERATOR</span></span><br><span class="line">	pointer <span class="keyword">operator</span>-&gt;() <span class="type">const</span> &#123; <span class="keyword">return</span> &amp;(<span class="keyword">operator</span>*()); &#125;</span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span> <span class="comment">/*__SGI_STL_NO_ARROW_OPERATOR */</span></span></span><br><span class="line">	</span><br><span class="line">	self&amp; <span class="keyword">operator</span>++() &#123; <span class="built_in">increment</span>(); <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">	self <span class="keyword">operator</span>++(<span class="type">int</span>) &#123;</span><br><span class="line">		self tmp = *<span class="keyword">this</span>;</span><br><span class="line">		<span class="built_in">increment</span>();</span><br><span class="line">		<span class="keyword">return</span> tmp;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	self&amp; <span class="keyword">operator</span>--() &#123; <span class="built_in">decrement</span>(); <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">	self <span class="keyword">operator</span>--(<span class="type">int</span>) &#123;</span><br><span class="line">		self tmp = *<span class="keyword">this</span>;</span><br><span class="line">		<span class="built_in">decrement</span>();		</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;              </span><br></pre></td></tr></table></figure>

<p><img src="/../img/inc%E5%92%8Cdec%E7%9A%84%E8%B4%B9%E8%A7%A3%E6%83%85%E5%86%B5.png" alt="incå’Œdecçš„è´¹è§£æƒ…å†µ"></p>
<h4 id="RB-treeçš„æ•°æ®ç»“æ„"><a href="#RB-treeçš„æ•°æ®ç»“æ„" class="headerlink" title="RB-treeçš„æ•°æ®ç»“æ„"></a>RB-treeçš„æ•°æ®ç»“æ„</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">KeyOfValue</span>, <span class="keyword">class</span> <span class="title class_">Compare</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">Alloc</span> = alloc&gt;</span><br><span class="line"><span class="keyword">class</span> rb_tree &#123;</span><br><span class="line">	<span class="keyword">protected</span>:</span><br><span class="line">		<span class="keyword">typedef</span> <span class="type">void</span>* void_pointer;</span><br><span class="line">		<span class="keyword">typedef</span> __rb_tree_node_base* base_ptr;</span><br><span class="line">		<span class="keyword">typedef</span> __rb_tree_node&lt;Value&gt; rb_tree_node;</span><br><span class="line">		<span class="keyword">typedef</span> simple_alloc&lt;rb_tree_node, Alloc&gt; rb_tree_node_allocator;</span><br><span class="line">		<span class="keyword">typedef</span> __rb_tree_color_type color_type;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">protected</span>:</span><br><span class="line">		<span class="comment">//RB-treeåªä»¥ä¸‰ç¬”æ•°æ®è¡¨ç°</span></span><br><span class="line">		size_type node_count; <span class="comment">//è¿½è¸ªè®°å½•æ ‘çš„å¤§å°</span></span><br><span class="line">		link_type header;     <span class="comment">//è¿™æ˜¯å®ç°çš„ä¸€ä¸ªæŠ€å·§</span></span><br><span class="line">		Compare key_compare;  <span class="comment">//èŠ‚ç‚¹é—´çš„é”®å€¼å¤§å°æ¯”è¾ƒå‡†åˆ™ï¼Œfunction object</span></span><br><span class="line">    </span><br><span class="line">		<span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå‡½æ•°ç”¨æ¥æ–¹ä¾¿å–å¾—headerçš„æˆå‘˜</span></span><br><span class="line">		<span class="function">link_type&amp; <span class="title">root</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> (link_type&amp;) header-&gt;parent; &#125;</span><br><span class="line">		<span class="function">link_type&amp; <span class="title">leftmost</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> (link_type&amp;) header-&gt;left; &#125;</span><br><span class="line">		<span class="function">link_type&amp; <span class="title">rightmost</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> (link_type&amp;) header-&gt;right;&#125;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="keyword">typedef</span> __rb_tree_iterator&lt;value_type, reference, pointer&gt; iterator;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		iterator __insert(base_ptr x, base_ptr y, <span class="type">const</span> value_type&amp; v);</span><br><span class="line">		link_type __copy(link_type x, link_type p);</span><br><span class="line">		<span class="type">void</span> __erase(link_type x);</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			header = <span class="built_in">get_node</span>();  <span class="comment">//äº§ç”Ÿä¸€ä¸ªèŠ‚ç‚¹ç©ºé—´ï¼Œä»¤headeræŒ‡å‘å®ƒ</span></span><br><span class="line">			<span class="built_in">color</span>(header) = __rb_tree_red; <span class="comment">//ä»¤headerä¸ºçº¢è‰²ï¼Œç”¨æ¥åŒºåˆ†header</span></span><br><span class="line">										<span class="comment">//å’Œrootï¼Œåœ¨iterator.operator++ä¹‹ä¸­</span></span><br><span class="line">			<span class="built_in">root</span>() = <span class="number">0</span>;</span><br><span class="line">			<span class="built_in">leftmost</span>() = header;	<span class="comment">//ä»¤headerçš„å·¦å­èŠ‚ç‚¹ä¸ºè‡ªå·±</span></span><br><span class="line">			<span class="built_in">rightmost</span>() = header;   <span class="comment">//ä»¤header çš„å³å­èŠ‚ç‚¹ä¸ºè‡ªå·±</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:				</span><br><span class="line">    					<span class="comment">//allocation / deallocation</span></span><br><span class="line">		<span class="built_in">rb_tree</span>(<span class="type">const</span> Compare&amp; comp = <span class="built_in">Compare</span>())</span><br><span class="line">			: <span class="built_in">node_count</span>(<span class="number">0</span>), <span class="built_in">key_compare</span>(comp) &#123; <span class="built_in">init</span>(); &#125;</span><br><span class="line">		</span><br><span class="line">		~<span class="built_in">rb_tree</span>() &#123;</span><br><span class="line">			<span class="built_in">clear</span>();</span><br><span class="line">			<span class="built_in">put_node</span>(header);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		rb_tree&lt;Key, Value, KeyOfValue, Comapre, Alloc&gt;&amp;</span><br><span class="line">		<span class="keyword">operator</span>=(<span class="type">const</span> rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;&amp; x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">								<span class="comment">//accessors:</span></span><br><span class="line">		<span class="function">Compare <span class="title">key_comp</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> key_compare; &#125;</span><br><span class="line">		<span class="function">iterator <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">leftmost</span>(); &#125; <span class="comment">//RBæ ‘çš„èµ·å¤´ä¸ºæœ€å·¦ï¼ˆæœ€å°ï¼‰èŠ‚ç‚¹å¤„</span></span><br><span class="line">		<span class="function">iterator <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> header; ) <span class="comment">//RBæ ‘çš„ç»ˆç‚¹ä¸ºheaderæ‰€æŒ‡å¤„</span></span><br><span class="line">		<span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> node_count == <span class="number">0</span>; &#125;</span><br><span class="line">		<span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> node_count; &#125;</span><br><span class="line">		<span class="function">size_type <span class="title">max_size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">size_type</span> (<span class="number">-1</span>); &#125;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">							<span class="comment">// insert / erase</span></span><br><span class="line">		<span class="comment">//å°†xæ’å…¥åˆ°RB-treeä¸­(ä¿æŒèŠ‚ç‚¹å€¼ç‹¬ä¸€æ— äºŒ)</span></span><br><span class="line">		<span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert_unique</span><span class="params">(<span class="type">const</span> value_type&amp; x)</span></span>;</span><br><span class="line">		<span class="comment">//å°†xæ’å…¥åˆ°RB-treeä¸­(å…è®¸èŠ‚ç‚¹å€¼é‡å¤)</span></span><br><span class="line">		<span class="function">iterator <span class="title">insert_equal</span><span class="params">(<span class="type">const</span> value_type&amp; x)</span></span>;</span><br><span class="line">	...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ ‘çŠ¶ç»“æ„çš„å„ç§æ“ä½œï¼Œæœ€éœ€æ³¨æ„çš„å°±æ˜¯è¾¹ç•Œæƒ…å†µçš„å‘ç”Ÿã€‚ä¸ºäº†ç®€åŒ–å¤„ç†ï¼ŒSGI STLç‰¹åˆ«ä¸ºæ ¹èŠ‚ç‚¹å†è®¾è®¡ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œåä¸ºheaderã€‚</p>
<p><img src="/../img/RB-treeheader.png" alt="RB-treeheader"></p>
<p>æ¯å½“æ’å…¥æ–°èŠ‚ç‚¹ä½¿ï¼Œä¸ä½†è¦æŒ‰ç…§RB-treeçš„è§„åˆ™æ¥è°ƒæ•´ï¼Œå¹¶ä¸”ç»´æŠ¤headerçš„æ­£ç¡®æ€§ï¼Œä½¿å…¶çˆ¶èŠ‚ç‚¹æŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œå·¦å­èŠ‚ç‚¹æŒ‡å‘æœ€å°èŠ‚ç‚¹ï¼Œå³å­èŠ‚ç‚¹æŒ‡å‘æœ€å¤§èŠ‚ç‚¹ã€‚</p>
<h4 id="RB-treeçš„å…ƒç´ æ“ä½œ"><a href="#RB-treeçš„å…ƒç´ æ“ä½œ" class="headerlink" title="RB-treeçš„å…ƒç´ æ“ä½œ"></a>RB-treeçš„å…ƒç´ æ“ä½œ</h4><p>RB-treeæä¾›ä¸¤ç§æ’å…¥æ“ä½œï¼šinsert_unique()å’ŒInsert_equal()ï¼Œå‰è€…è¡¨ç¤ºè¢«æ’å…¥èŠ‚ç‚¹çš„é”®å€¼åœ¨æ•´æ£µæ ‘ä¸­å¿…é¡»ç‹¬ä¸€æ— äºŒï¼Œåè€…è¡¨ç¤ºè¢«æ’å…¥èŠ‚ç‚¹çš„é”®å€¼åœ¨æ•´æ£µæ ‘ä¸­å¯ä»¥é‡å¤ã€‚ä»¥ä¸‹ä»¥æœ€ç®€å•çš„ç‰ˆæœ¬ä½œä¸ºè¯´æ˜å¯¹è±¡ï¼š</p>
<h5 id="å…ƒç´ æ’å…¥æ“ä½œinsert-equal"><a href="#å…ƒç´ æ’å…¥æ“ä½œinsert-equal" class="headerlink" title="å…ƒç´ æ’å…¥æ“ä½œinsert_equal()"></a>å…ƒç´ æ’å…¥æ“ä½œinsert_equal()</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ’äººæ–°å€¼:èŠ‚ç‚¹é”®å€¼å…è®¸é‡å¤</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªRB-treeè¿­ä»£å™¨ï¼ŒæŒ‡å‘æ–°å¢èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">key</span>, <span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">Keyofvalue</span>, <span class="keyword">class</span> <span class="title class_">Compare</span>, <span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> rb_tree&lt;Key, Value, KeyOfvalue, Compare, Alloc&gt;::iterator</span><br><span class="line">rb_tree&lt;Key, value, KeyofValue, Compare, Alloc&gt;::<span class="built_in">insert_equal</span>(<span class="type">const</span> Value&amp; v)</span><br><span class="line">&#123;</span><br><span class="line">	link_type y = header;</span><br><span class="line">	link_type x = <span class="built_in">root</span>();      <span class="comment">//ä»æ ¹èŠ‚ç‚¹å¼€å§‹</span></span><br><span class="line">	<span class="keyword">while</span>(x != <span class="number">0</span>) &#123;            <span class="comment">//ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¾€ä¸‹å¯»æ‰¾é€‚å½“çš„æ’äººç‚¹</span></span><br><span class="line">		y = x;</span><br><span class="line">		x = <span class="built_in">key_compare</span>(<span class="built_in">KeyOfvalue</span>()(v), <span class="built_in">key</span>(x)) ? <span class="built_in">left</span>(x) : <span class="built_in">right</span>(x);</span><br><span class="line">		<span class="comment">//ä»¥ä¸Šï¼Œé‡â€œå¤§â€åˆ™å¾€å·¦ï¼Œé‡â€œå°äºæˆ–ç­‰äºâ€åˆ™å¾€å³</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> __insert(x, y, v);</span><br><span class="line">	<span class="comment">//ä»¥ä¸Šï¼Œxä¸ºæ–°å€¼æ’äººç‚¹ï¼Œyä¸ºæ’äººç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ï¼Œvä¸ºæ–°å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å…ƒç´ æ’å…¥æ“ä½œinsert-unique"><a href="#å…ƒç´ æ’å…¥æ“ä½œinsert-unique" class="headerlink" title="å…ƒç´ æ’å…¥æ“ä½œinsert_unique()"></a>å…ƒç´ æ’å…¥æ“ä½œinsert_unique()</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ’äººæ–°å€¼ï¼šèŠ‚ç‚¹é”®å€¼ä¸å…è®¸é‡å¤ï¼Œè‹¥é‡å¤åˆ™æ’äººæ— æ•ˆ</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œè¿”å›å€¼æ˜¯ä¸ªpairï¼Œç¬¬ä¸€å…ƒç´ æ˜¯ä¸ªRB-treeè¿­ä»£å™¨ï¼ŒæŒ‡å‘æ–°å¢èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment">//ç¬¬äºŒå…ƒç´ è¡¨ç¤ºæ’å…¥æˆåŠŸä¸å¦</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">KeyOfValue</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">Compare</span>, <span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;</span><br><span class="line">pair&lt;<span class="keyword">typename</span> rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;::iterator, <span class="type">bool</span>&gt;</span><br><span class="line">rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;::<span class="built_in">insert_unique</span>(<span class="type">const</span> value&amp; v)</span><br><span class="line">&#123;</span><br><span class="line">	link_type y = header;</span><br><span class="line">	link_type x = <span class="built_in">root</span>();          <span class="comment">//ä»æ ¹èŠ‚ç‚¹å¼€å§‹</span></span><br><span class="line">	<span class="type">bool</span> comp = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">while</span> (x != <span class="number">0</span>) &#123;               <span class="comment">//ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¾€ä¸‹å¯»æ‰¾é€‚å½“çš„æ’äººç‚¹</span></span><br><span class="line">		y = x;</span><br><span class="line">		comp = <span class="built_in">key_compare</span>(<span class="built_in">KeyOfValue</span>()(v), <span class="built_in">key</span>(x));<span class="comment">//vé”®å€¼å°äºç›®å‰èŠ‚ç‚¹ä¹‹é”®å€¼?</span></span><br><span class="line">		x = comp ? <span class="built_in">left</span>(x) : <span class="built_in">right</span> (x);<span class="comment">//é‡â€œå¤§â€åˆ™å¾€å·¦ï¼Œé‡â€œå°äºæˆ–ç­‰äºâ€åˆ™å¾€å³</span></span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">	<span class="comment">//ç¦»å¼€whileå¾ªç¯ä¹‹åï¼Œyæ‰€æŒ‡å³æ’å…¥ç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ï¼ˆæ­¤æ—¶çš„å®ƒå¿…ä¸ºå¶èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">	iterator j = <span class="built_in">iterator</span>(y);   <span class="comment">//ä»¤è¿­ä»£å™¨jæŒ‡å‘æ’å…¥ç‚¹ä¹‹çˆ¶èŠ‚ç‚¹y</span></span><br><span class="line">	<span class="keyword">if</span> (comp)  <span class="comment">// å¦‚æœç¦»å¼€whileå¾ªç¯æ—¶compä¸ºçœŸï¼ˆè¡¨ç¤ºé‡â€œå¤§â€ï¼Œå°†æ’å…¥äºå·¦ä¾§)</span></span><br><span class="line">		<span class="keyword">if</span> (j == <span class="built_in">begin</span>())   <span class="comment">//å¦‚æœæ’å…¥ç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ä¸ºæœ€å·¦èŠ‚ç‚¹</span></span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">pair</span>&lt;iterator, <span class="type">bool</span>&gt;(__insert (x, y, v), <span class="literal">true</span>);</span><br><span class="line">			<span class="comment">//ä»¥ä¸Šï¼Œxä¸ºæ’å…¥ç‚¹ï¼Œyä¸ºæ’å…¥ç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ï¼Œvä¸ºæ–°å€¼</span></span><br><span class="line">		<span class="keyword">else</span> <span class="comment">//å¦åˆ™(æ’äººç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ä¸ä¸ºæœ€å·¦èŠ‚ç‚¹)</span></span><br><span class="line">			--j;</span><br><span class="line">			<span class="comment">//è°ƒæ•´jï¼Œå›å¤´å‡†å¤‡æµ‹è¯•...</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">key_compare</span>(<span class="built_in">key</span>(j.node), <span class="built_in">KeyOfValue</span>()(v)))</span><br><span class="line">		<span class="comment">//å°äºæ–°å€¼ï¼ˆè¡¨ç¤ºé‡â€œå°â€ï¼Œå°†æ’å…¥äºå³ä¾§)</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">pair</span>&lt;iterator, <span class="type">bool</span>&gt;(__insert (x, y, v), <span class="literal">true</span>);</span><br><span class="line">		<span class="comment">//ä»¥ä¸Šï¼Œxä¸ºæ–°å€¼æ’äººç‚¹ï¼Œy ä¸ºæ’äººç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ï¼Œvä¸ºæ–°å€¼</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿›è¡Œè‡³æ­¤ï¼Œè¡¨ç¤ºæ–°å€¼ä¸€å®šä¸æ ‘ä¸­é”®å€¼é‡å¤ï¼Œé‚£ä¹ˆå°±ä¸è¯¥æ’å…¥æ–°å€¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pair</span>&lt;iterator, <span class="type">bool</span>&gt;(j, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœŸæ­£çš„æ’å…¥æ‰§è¡Œç¨‹åº__insert()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">KeyOfValue</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">Compare</span>, <span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;::iterator</span><br><span class="line">rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;::__insert(base_ptr x_, base_ptr y_, <span class="type">const</span> Value&amp; v) &#123;</span><br><span class="line"><span class="comment">//å‚æ•°x_ä¸ºæ–°å€¼æ’äººç‚¹ï¼Œå‚æ•°y_ä¸ºæ’äººç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ï¼Œå‚æ•°vä¸ºæ–°å€¼</span></span><br><span class="line">	link_type x = (link_type)x_;</span><br><span class="line">	link_type y = (link_type)y_;</span><br><span class="line">	link_type z;</span><br><span class="line"></span><br><span class="line"><span class="comment">//key_compareæ˜¯é”®å€¼å¤§å°æ¯”è¾ƒå‡†åˆ™ã€‚åº”è¯¥ä¼šæ˜¯ä¸ªfunction object</span></span><br><span class="line">	<span class="keyword">if</span> (y == header || x != <span class="number">0</span> || <span class="built_in">key_compare</span>(<span class="built_in">KeyOfValue</span>()(v), <span class="built_in">key</span>(y))) &#123;</span><br><span class="line">		z = <span class="built_in">create_node</span>(v); <span class="comment">//äº§ç”Ÿä¸€ä¸ªæ–°èŠ‚ç‚¹</span></span><br><span class="line">		<span class="built_in">left</span>(y) = z;        <span class="comment">//è¿™ä½¿å¾—å½“yå³ä¸ºheaderæ—¶ï¼Œleftmost() = z</span></span><br><span class="line">		<span class="keyword">if</span> (y == header) &#123;</span><br><span class="line">			<span class="built_in">root</span>() = z;</span><br><span class="line">			<span class="built_in">rightmost</span>() = z;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (y == <span class="built_in">leftmost</span>())             <span class="comment">//å¦‚æœyä¸ºæœ€å·¦èŠ‚ç‚¹</span></span><br><span class="line">			<span class="built_in">leftmost</span>() = z;        <span class="comment">//ç»´æŠ¤leftmost()ï¼Œä½¿å®ƒæ°¸è¿œæŒ‡å‘æœ€å·¦èŠ‚ç‚¹</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		z = <span class="built_in">create_node</span>(v);            <span class="comment">//äº§ç”Ÿä¸€ä¸ªæ–°èŠ‚ç‚¹</span></span><br><span class="line">		<span class="built_in">right</span>(y) = z;            <span class="comment">//ä»¤æ–°èŠ‚ç‚¹æˆä¸ºæ’äººç‚¹ä¹‹çˆ¶èŠ‚ç‚¹yçš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">		<span class="keyword">if</span> (y == <span class="built_in">rightmost</span>())</span><br><span class="line">			<span class="built_in">rightmost</span>() = z;      <span class="comment">//ç»´æŠ¤rightmost()ï¼Œä½¿å®ƒæ°¸è¿œæŒ‡å‘æœ€å³èŠ‚ç‚¹</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">parent</span>(z) = y;                 <span class="comment">//è®¾å®šæ–°èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">	<span class="built_in">left</span>(z) = <span class="number">0</span>;                   <span class="comment">//è®¾å®šæ–°èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">	<span class="built_in">right</span>(z) = <span class="number">0</span>;                  <span class="comment">//è®¾å®šæ–°èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">					<span class="comment">//æ–°èŠ‚ç‚¹çš„é¢œè‰²å°†åœ¨__rb_tree_rebalance()è®¾å®šï¼ˆå¹¶è°ƒæ•´ï¼‰</span></span><br><span class="line">	__rb_tree_rebalance(z, header-&gt;parent); <span class="comment">//å‚æ•°ä¸€ä¸ºæ–°å¢èŠ‚ç‚¹ï¼Œå‚æ•°äºŒä¸ºroot</span></span><br><span class="line">	++node_count;   <span class="comment">//èŠ‚ç‚¹æ•°ç´¯åŠ </span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">iterator</span>(z);<span class="comment">//è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘æ–°å¢èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="è°ƒæ•´RB-treeï¼ˆæ—‹è½¬åŠæ”¹å˜é¢œè‰²ï¼‰"><a href="#è°ƒæ•´RB-treeï¼ˆæ—‹è½¬åŠæ”¹å˜é¢œè‰²ï¼‰" class="headerlink" title="è°ƒæ•´RB-treeï¼ˆæ—‹è½¬åŠæ”¹å˜é¢œè‰²ï¼‰"></a>è°ƒæ•´RB-treeï¼ˆæ—‹è½¬åŠæ”¹å˜é¢œè‰²ï¼‰</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€å‡½æ•°</span></span><br><span class="line"><span class="comment">//é‡æ–°ä»¤æ ‘å½¢å¹³è¡¡ï¼ˆæ”¹å˜é¢œè‰²åŠæ—‹è½¬æ ‘å½¢ï¼‰</span></span><br><span class="line"><span class="comment">//å‚æ•°ä¸€ä¸ºæ–°å¢èŠ‚ç‚¹ï¼Œå‚æ•°äºŒä¸ºroot</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span></span><br><span class="line">__rb_tree_rebalance(__rb_tree_node_base* x, __rb_tree_node_base*&amp; root) &#123;</span><br><span class="line">	x-&gt;color = __rb_tree_red;	<span class="comment">//æ–°èŠ‚ç‚¹å¿…ä¸ºçº¢</span></span><br><span class="line">	<span class="keyword">while</span> (x != root &amp;&amp; x-&gt;parent-&gt;color == __rb_tree_red) &#123; <span class="comment">//çˆ¶èŠ‚ç‚¹ä¸ºçº¢</span></span><br><span class="line">		<span class="keyword">if</span> (x-&gt;parent == x-&gt;parent-&gt;parent-&gt;left) &#123; <span class="comment">//çˆ¶èŠ‚ç‚¹ä¸ºç¥–çˆ¶èŠ‚ç‚¹ä¹‹å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">			__rb_tree_node_base* y = x-&gt;parent-&gt;parent-&gt;right;<span class="comment">//ä»¤yä¸ºä¼¯çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">			<span class="keyword">if</span> (y &amp;&amp; y-&gt;color == __rb_tree_red) &#123;   <span class="comment">//ä¼¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä¸”ä¸ºçº¢</span></span><br><span class="line">				x-&gt;parent-&gt;color = __rb_tree_black; <span class="comment">//æ›´æ”¹çˆ¶èŠ‚ç‚¹ä¸ºé»‘</span></span><br><span class="line">				y-&gt;color = __rb_tree_black;         <span class="comment">//æ›´æ”¹ä¼¯çˆ¶èŠ‚ç‚¹ä¸ºé»‘</span></span><br><span class="line">				x-&gt;parent-&gt;parent-&gt;color = __rb_tree_red;<span class="comment">//æ›´æ”¹ç¥–çˆ¶èŠ‚ç‚¹ä¸ºçº¢</span></span><br><span class="line">				x = x-&gt;parent-&gt;parent;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123; <span class="comment">//æ— ä¼¯çˆ¶èŠ‚ç‚¹ï¼Œæˆ–ä¼¯çˆ¶èŠ‚ç‚¹ä¸ºé»‘</span></span><br><span class="line">				<span class="keyword">if</span> (x = x-&gt;parent-&gt;right) &#123;<span class="comment">//å¦‚æœæ–°èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹ä¹‹å³å­èŠ‚ç‚¹</span></span><br><span class="line">					x = x-&gt;parent;</span><br><span class="line">					__rb_tree_rotate_left(x, root); <span class="comment">//ç¬¬ä¸€å‚æ•°ä¸ºå·¦æ—‹ç‚¹</span></span><br><span class="line">				&#125;</span><br><span class="line">				x-&gt;parent-&gt;color = __rb_tree_black;<span class="comment">//æ”¹å˜é¢œè‰²</span></span><br><span class="line">				x-&gt;parent-&gt;parent-&gt;color = __rb_tree_red;</span><br><span class="line">				__rb_tree_rotate_right(x-&gt;parent-&gt;parent, root); <span class="comment">//ç¬¬ä¸€å‚æ•°ä¸ºå³æ—‹ç‚¹</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;    <span class="comment">//çˆ¶èŠ‚ç‚¹ä¸ºç¥–çˆ¶èŠ‚ç‚¹ä¹‹å³å­èŠ‚ç‚¹</span></span><br><span class="line">			__rb_tree_node_base* y = x-&gt;parent-&gt;parent-&gt;left; <span class="comment">//ä»¤yä¸ºä¼¯çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">			<span class="keyword">if</span> (y &amp;&amp; y-&gt;color == __rb_tree_red) &#123;   <span class="comment">//æœ‰ä¼¯çˆ¶èŠ‚ç‚¹ï¼Œä¸”ä¸ºçº¢</span></span><br><span class="line">				x-&gt;parent-&gt;color = __rb_tree_black; <span class="comment">//æ›´æ”¹çˆ¶èŠ‚ç‚¹ä¸ºé»‘</span></span><br><span class="line">				y-&gt;color = __rb_tree_black;        <span class="comment">//æ›´æ”¹ä¼¯çˆ¶èŠ‚ç‚¹ä¸ºé»‘</span></span><br><span class="line">				x-&gt;parent-&gt;parent-&gt;color = __rb_tree_red;<span class="comment">//æ›´æ”¹ç¥–çˆ¶èŠ‚ç‚¹ä¸ºçº¢</span></span><br><span class="line">				x = x-&gt;parent-&gt;parent;<span class="comment">//å‡†å¤‡ç»§ç»­å¾€ä¸Šå±‚æ£€æŸ¥</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123; <span class="comment">//æ— ä¼¯çˆ¶èŠ‚ç‚¹ï¼Œæˆ–ä¼¯çˆ¶èŠ‚ç‚¹ä¸ºé»‘</span></span><br><span class="line">				<span class="keyword">if</span> (x == x-&gt;parent-&gt;left) &#123; <span class="comment">//å¦‚æœæ–°èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹ä¹‹å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">					x= x-&gt;parent;</span><br><span class="line">					__rb_tree_rotate_right(x, root);<span class="comment">//ç¬¬ä¸€å‚æ•°ä¸ºå³æ—‹ç‚¹</span></span><br><span class="line">				&#125;</span><br><span class="line">				x-&gt;parent-&gt;color = __rb_tree_black;<span class="comment">//æ”¹å˜é¢œè‰²</span></span><br><span class="line">				x-&gt;parent -&gt;parent-&gt;color = __rb_tree_red;</span><br><span class="line">				__rb_tree_rotate_left(x-&gt;parent-&gt;parent, root); <span class="comment">//ç¬¬ä¸€å‚æ•°ä¸ºå·¦æ—‹ç‚¹</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="comment">//while ç»“æŸ</span></span><br><span class="line">	root-&gt;color = __rb_tree_black;<span class="comment">//æ ¹èŠ‚ç‚¹æ°¸è¿œä¸ºé»‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯å·¦æ—‹å‡½æ•°å’Œå³æ—‹å‡½æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€å‡½æ•°</span></span><br><span class="line"><span class="comment">//æ–°èŠ‚ç‚¹å¿…ä¸ºçº¢èŠ‚ç‚¹ã€‚å¦‚æœæ’å…¥å¤„ä¹‹çˆ¶èŠ‚ç‚¹äº¦ä¸ºçº¢èŠ‚ç‚¹ï¼Œå°±è¿åçº¢é»‘æ ‘è§„åˆ™ï¼Œæ­¤æ—¶å¿…é¡»</span></span><br><span class="line"><span class="comment">//åšæ ‘å½¢æ—‹è½¬ï¼ˆåŠé¢œè‰²æ”¹å˜ï¼Œåœ¨ç¨‹åºå®ƒå¤„ï¼‰</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span></span><br><span class="line">__rb_tree_rotate_left (__rb_tree_node_base* x, __rb_tree_node_base*&amp; root)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//xä¸ºæ—‹è½¬ç‚¹</span></span><br><span class="line">	__rb_tree_node__base* y = x-&gt;right; <span class="comment">//ä»¤yä¸ºæ—‹è½¬ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">	x-&gt;right = y-&gt;left;</span><br><span class="line">	<span class="keyword">if</span> (y-&gt;left != <span class="number">0</span>)</span><br><span class="line">		y-&gt;left-&gt;parent = x;   <span class="comment">//åˆ«å¿˜äº†å›é©¬æªè®¾å®šçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">	y-&gt;parent = x-&gt;parent;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//ä»¤yå®Œå…¨é¡¶æ›¿xçš„åœ°ä½ï¼ˆå¿…é¡»å°†xå¯¹å…¶çˆ¶èŠ‚ç‚¹çš„å…³ç³»å®Œå…¨æ¥æ”¶è¿‡æ¥)</span></span><br><span class="line">	<span class="keyword">if</span> (x == root)       <span class="comment">//xä¸ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">		root = y;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x == x-&gt;parent-&gt;left)   <span class="comment">//xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">		x-&gt;parent-&gt;left = y;</span><br><span class="line">	<span class="keyword">else</span>                             <span class="comment">//xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">		x-&gt;parent-&gt;right = y;</span><br><span class="line">	y-&gt;left = x;</span><br><span class="line">	x-&gt;parent = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¨å±€å‡½æ•°</span></span><br><span class="line"><span class="comment">//æ–°èŠ‚ç‚¹å¿…ä¸ºçº¢èŠ‚ç‚¹ã€‚å¦‚æœæ’å…¥å¤„ä¹‹çˆ¶èŠ‚ç‚¹äº¦ä¸ºçº¢èŠ‚ç‚¹ï¼Œå°±è¿åçº¢é»‘æ ‘è§„åˆ™ï¼Œæ­¤æ—¶å¿…é¡»</span></span><br><span class="line"><span class="comment">//åšæ ‘å½¢æ—‹è½¬ï¼ˆåŠé¢œè‰²æ”¹å˜ï¼Œåœ¨ç¨‹åºå®ƒå¤„ï¼‰</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span></span><br><span class="line">__rb_tree_rotate_right (__rb_tree_node_base* x,</span><br><span class="line">				      __rb_tree_node_base*&amp; root)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//xä¸ºæ—‹è½¬ç‚¹</span></span><br><span class="line">	__rb_tree_node__base* y = x-&gt;left; <span class="comment">//ä»¤yä¸ºæ—‹è½¬ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">	x-&gt;left = y-&gt;right;</span><br><span class="line">	<span class="keyword">if</span> (y-&gt;right != <span class="number">0</span>)</span><br><span class="line">		y-&gt;right-&gt;parent = x;   <span class="comment">//åˆ«å¿˜äº†å›é©¬æªè®¾å®šçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">	y-&gt;parent = x-&gt;parent;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//ä»¤yå®Œå…¨é¡¶æ›¿xçš„åœ°ä½ï¼ˆå¿…é¡»å°†xå¯¹å…¶çˆ¶èŠ‚ç‚¹çš„å…³ç³»å®Œå…¨æ¥æ”¶è¿‡æ¥)</span></span><br><span class="line">	<span class="keyword">if</span> (x == root)       <span class="comment">//xä¸ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">		root = y;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x == x-&gt;parent-&gt;right)   <span class="comment">//xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">		x-&gt;parent-&gt;right = y;</span><br><span class="line">	<span class="keyword">else</span>                             <span class="comment">//xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">		x-&gt;parent-&gt;left = y;</span><br><span class="line">	y-&gt;right = x;</span><br><span class="line">	x-&gt;parent = y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å…ƒç´ çš„æœå¯»"><a href="#å…ƒç´ çš„æœå¯»" class="headerlink" title="å…ƒç´ çš„æœå¯»"></a>å…ƒç´ çš„æœå¯»</h5><p>RB-treeæä¾›çš„findå‡½æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯»æ‰¾RBæ ‘ä¸­æ˜¯å¦æœ‰é”®å€¼ä¸ºkçš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">KeyOfValue</span>, <span class="keyword">class</span> <span class="title class_">Compare</span>, <span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;::iterator</span><br><span class="line">rb_tree&lt;Key, Value, KeyOfValue, Compare, Alloc&gt;::<span class="built_in">find</span> (<span class="type">const</span> Key&amp; k &#123;</span><br><span class="line">	link_type y = header;     <span class="comment">//Last node which is not less than k.</span></span><br><span class="line">	link_type x = <span class="built_in">root</span>();     <span class="comment">//current node.</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> (x != <span class="number">0</span>)</span><br><span class="line">		<span class="comment">//ä»¥ä¸‹ï¼Œkey_compareæ˜¯èŠ‚ç‚¹é”®å€¼å¤§å°æ¯”è¾ƒå‡†åˆ™ã€‚åº”è¯¥ä¼šæ˜¯ä¸ªfunction object</span></span><br><span class="line">		<span class="keyword">if</span>(!<span class="built_in">key_compare</span>(<span class="built_in">key</span>(x), k))</span><br><span class="line">			<span class="comment">//è¿›è¡Œåˆ°è¿™é‡Œ,è¡¨ç¤ºxé”®å€¼å¤§äºkã€‚é‡åˆ°å¤§å€¼å°±å‘å·¦èµ°</span></span><br><span class="line">			y = x, x = <span class="built_in">left</span>(x);<span class="comment">//æ³¨æ„è¯­æ³•!</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="comment">//è¿›è¡Œåˆ°è¿™é‡Œï¼Œè¡¨ç¤ºÃ—é”®å€¼å°äºkã€‚é‡åˆ°å°å€¼å°±å‘å³èµ°</span></span><br><span class="line">			x = <span class="built_in">right</span>(x);</span><br><span class="line">		</span><br><span class="line">	iterator j = <span class="built_in">iterator</span>(y);</span><br><span class="line">	<span class="built_in">return</span> (j == <span class="built_in">end</span>() || <span class="built_in">key_compare</span>(k, <span class="built_in">key</span>(j.node))) ? <span class="built_in">end</span>() : j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>setçš„æ‰€æœ‰å…ƒç´ éƒ½ä¼šæ ¹æ®å…ƒç´ çš„é”®å€¼è‡ªåŠ¨è¢«æ’åºã€‚</p>
<p>setå…ƒç´ çš„é”®å€¼å°±æ˜¯å®å€¼ï¼Œå®å€¼å°±æ˜¯é”®å€¼ã€‚setä¸è¢«å…è®¸ä¸¤ä¸ªå…ƒç´ æœ‰ç›¸åŒçš„é”®å€¼ã€‚</p>
<p>setçš„è¿­ä»£å™¨æ˜¯ä¸€ç§constant iteratorsï¼Œæœç»å†™å…¥æ“ä½œï¼Œä¸èƒ½æ”¹å˜setçš„å…ƒç´ å€¼ï¼šå› ä¸ºsetçš„å…ƒç´ å€¼å°±æ˜¯å…¶é”®å€¼ï¼Œå…³ç³»åˆ°setå…ƒç´ çš„æ’åˆ—è§„åˆ™ã€‚åŒæ—¶ï¼Œsetåœ¨è¿›è¡Œå…ƒç´ æ–°å¢æ“ä½œæˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œæ“ä½œä¹‹å‰çš„æ‰€æœ‰è¿­ä»£å™¨ï¼ˆé™¤äº†è¢«åˆ é™¤çš„é‚£ä¸ªè¿­ä»£å™¨ï¼‰åœ¨æ“ä½œå®Œæˆä¹‹åä¾ç„¶æœ‰æ•ˆï¼ˆç±»ä¼¼äºlistï¼‰ã€‚</p>
<p>ç”±äºRB-treeæ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œè‡ªåŠ¨æ’åºçš„æ•ˆæœå¾ˆä¸é”™ï¼Œæ‰€ä»¥æ ‡å‡†çš„STL setå³ä»¥RB-treeä¸ºåº•å±‚æœºåˆ¶ã€‚åˆç”±äºsetæ‰€å¼€æ”¾çš„å„ç§æ“ä½œæ¥å£ï¼ŒRB-treeä¹Ÿéƒ½æä¾›äº†ï¼Œæ‰€ä»¥å‡ ä¹æ‰€æœ‰çš„setæ“ä½œè¡Œä¸ºï¼Œéƒ½åªæ˜¯è½¬è°ƒç”¨RB-treeçš„æ“ä½œè¡Œä¸ºè€Œå·²ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">Compare</span> = less&lt;Key&gt;,        <span class="comment">//ç¼ºçœæƒ…å†µä¸‹é‡‡ç”¨é€’å¢æ’åº</span></span><br><span class="line">		 <span class="keyword">class</span> Alloc = alloc&gt;</span><br><span class="line"><span class="keyword">class</span> set &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// typedefs :</span></span><br><span class="line">	<span class="keyword">typedef</span> Key key_type;</span><br><span class="line">	<span class="keyword">typedef</span> Key value_type;</span><br><span class="line">	<span class="comment">//æ³¨æ„ï¼Œä»¥ä¸‹key_compareå’Œvalue_compareä½¿ç”¨åŒä¸€ä¸ªæ¯”è¾ƒå‡½æ•°</span></span><br><span class="line">	<span class="keyword">typedef</span> Compare ke _compare;</span><br><span class="line">	<span class="keyword">typedef</span> Compare value_compare;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//æ³¨æ„ï¼Œä»¥ä¸‹çš„identityå®šä¹‰äº&lt;stl_function.h&gt;ï¼Œå‚è§ç¬¬7ç« ï¼Œå…¶å®šä¹‰ä¸º:</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	template &lt;class T&gt;</span></span><br><span class="line"><span class="comment">	struct identity : public unary_function&lt;T,T&gt; &#123;</span></span><br><span class="line"><span class="comment">		const T&amp; operator() (const T&amp; x) const &#123; return x; &#125;</span></span><br><span class="line"><span class="comment">	&#125;;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">typedef</span> rb_tree&lt;key_type, value_type,</span><br><span class="line">				identity&lt;value_type&gt;, key_compare, Alloc&gt; rep_type;</span><br><span class="line">	rep_type t; <span class="comment">//é‡‡ç”¨çº¢é»‘æ ‘(RB-tree)æ¥è¡¨ç°set</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_pointer pointer;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_pointer const_pointer;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_reference reference;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_reference const_reference;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_iterator iterator;</span><br><span class="line">	<span class="comment">//æ³¨æ„ä¸Šä¸€è¡Œï¼Œiteratorå®šä¹‰ä¸ºRB-treeçš„const_iteratorï¼Œè¿™è¡¨ç¤ºsetsçš„</span></span><br><span class="line">    <span class="comment">//è¿­ä»£å™¨æ— æ³•æ‰§è¡Œå†™å…¥æ“ä½œã€‚è¿™æ˜¯å› ä¸ºsetçš„å…ƒç´ æœ‰ä¸€å®šæ¬¡åºå®‰æ’</span></span><br><span class="line">	<span class="comment">//ä¸å…è®¸ç”¨æˆ·åœ¨ä»»æ„å¤„è¿›è¡Œå†™äººæ“ä½œ</span></span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_iterator const_iterator;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_reverse_iterator reverse_iterator;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::const_reverse_iterator const_reverse_iterator;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::size_type size_type;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::difference_type difference_type;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// allocation / deallocation</span></span><br><span class="line">	<span class="comment">//æ³¨æ„,setä¸€å®šä½¿ç”¨RB-treeçš„insert_unique()è€Œéinsert_equal()</span></span><br><span class="line">	<span class="comment">//multisetæ‰ä½¿ç”¨RB-treeçš„insert__equal()</span></span><br><span class="line">	<span class="comment">//å› ä¸ºsetä¸å…è®¸ç›¸åŒé”®å€¼å­˜åœ¨ï¼Œmultisetæ‰å…è®¸ç›¸åŒé”®å€¼å­˜åœ¨</span></span><br><span class="line">	<span class="built_in">set</span>() : <span class="built_in">t</span> (<span class="built_in">Compare</span>()) &#123; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">set</span><span class="params">(<span class="type">const</span> Compare&amp; comp)</span> : t(comp)&#123;</span> &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">InputIterator</span>&gt;</span><br><span class="line">	<span class="built_in">set</span>(InputIterator first, InputIterator last)</span><br><span class="line">		: <span class="built_in">t</span>(<span class="built_in">Compare</span>()) &#123; t.<span class="built_in">insert_unique</span>(first, last); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">InputIterator</span>&gt;</span><br><span class="line">	<span class="built_in">set</span>(InputIterator first, InputIterator last, <span class="type">const</span> Compare&amp; comp)</span><br><span class="line">        : <span class="built_in">t</span>(comp) &#123; t.<span class="built_in">insert_unique</span>(first, last); &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="built_in">set</span>(<span class="type">const</span> set&lt;Key, Compare, Alloc&gt;&amp; x) : <span class="built_in">t</span>(x.t) &#123;&#125;</span><br><span class="line">	set&lt;Key, Compare, Alloc&gt;&amp; <span class="keyword">operator</span>=(<span class="type">const</span> set&lt;Key, Compare, Alloc&gt;&amp; x) &#123; </span><br><span class="line">		t = x.t;</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">   </span><br><span class="line">	<span class="comment">//ä»¥ä¸‹æ‰€æœ‰çš„setæ“ä½œè¡Œä¸ºï¼ŒRB-treeéƒ½å·²æä¾›ï¼Œæ‰€ä»¥setåªè¦ä¼ é€’è°ƒç”¨å³å¯</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//accessors:</span></span><br><span class="line">	<span class="function">key_compare <span class="title">key_comp</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">key_comp</span>(); &#125;</span><br><span class="line">	<span class="comment">//ä»¥ä¸‹æ³¨æ„,setçš„value_comp()äº‹å®ä¸Šä¸ºRB-treeçš„key_comp()</span></span><br><span class="line">	<span class="function">value_compare <span class="title">value_comp</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">key_comp</span>(); &#125;</span><br><span class="line">	<span class="function">iterator <span class="title">begin</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">begin</span>(); &#125;</span><br><span class="line">	<span class="function">iterator <span class="title">end</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">end</span>(); &#125;</span><br><span class="line">	<span class="function">reverse_iterator <span class="title">rbegin</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">rbegin</span>(); &#125;</span><br><span class="line">	<span class="function">reverse_iterator <span class="title">rend</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">rend</span>(); &#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">empty</span>(); &#125;</span><br><span class="line">	<span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">size</span>(); &#125;</span><br><span class="line">	<span class="function">size_type <span class="title">max_size</span><span class="params">( )</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">max_size</span>(); &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(set&lt;Key, Compare, Alloc&gt;&amp; x)</span> </span>&#123; t.<span class="built_in">swap</span>(x.t); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// insert/erase</span></span><br><span class="line">	<span class="keyword">typedef</span> pair&lt;iterator, <span class="type">bool</span>&gt; pair_iterator_bool;</span><br><span class="line">	<span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert</span><span class="params">(<span class="type">const</span> value_type&amp; x)</span> </span>&#123;</span><br><span class="line">		pair&lt;<span class="keyword">typename</span> rep_type::iterator, <span class="type">bool</span>&gt; p = t.<span class="built_in">insert_unique</span>(x);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">pair</span>&lt;iterator, <span class="type">bool</span>&gt;(p.first, p.second);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">iterator <span class="title">insert</span><span class="params">(iterator position, <span class="type">const</span> value_type&amp; x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::iterator rep_iterator;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">insert_unique</span>((rep_iterator&amp;)position, x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">InputIterator</span>&gt;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(InputIterator first, InputIterator last)</span> </span>&#123;</span><br><span class="line">		t.<span class="built_in">insert__unique</span>(first, last);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(iterator position)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::iterator rep_iterator;</span><br><span class="line">		t.<span class="built_in">erase</span>((rep_iterator&amp;)position);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">size_type <span class="title">erase</span><span class="params">(<span class="type">const</span> key_type&amp; x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">erase</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">erase</span> <span class="params">(iterator first, iterator last)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::iterator rep_iterator;</span><br><span class="line">         t.<span class="built_in">erase</span>((rep_iterator&amp;)first, (rep_iterator&amp;)Last);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; t.<span class="built_in">clear</span>(); &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// set operations:</span></span><br><span class="line">	<span class="function">iterator <span class="title">find</span><span class="params">(<span class="type">const</span> key_type&amp; x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">find</span>(x); &#125;</span><br><span class="line">	<span class="function">size_type <span class="title">count</span> <span class="params">(<span class="type">const</span> key_type&amp; x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> t.<span class="built_in">count</span>(x); &#125;</span><br><span class="line">	<span class="function">iterator <span class="title">lower_bound</span> <span class="params">(<span class="type">const</span> key_type&amp; x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">lower_bound</span>(x); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">iterator <span class="title">upper_bound</span> <span class="params">(<span class="type">const</span> key_type&amp; x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">upper_bound</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function">pair&lt;iterator, iterator&gt; <span class="title">equal_range</span><span class="params">(<span class="type">const</span> key type&amp; x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">equal_range</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>mapä¸setç±»ä¼¼ï¼Œéƒ½ä»¥RB-treeä¸ºåº•å±‚ï¼Œä¸åŒçš„æ˜¯mapçš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯pairï¼ŒåŒæ—¶æ‹¥æœ‰å®å€¼ï¼ˆvalueï¼‰å’Œé”®å€¼ï¼ˆkeyï¼‰ã€‚pairçš„ç¬¬ä¸€å…ƒç´ è¢«è§†ä¸ºé”®å€¼ï¼Œç¬¬äºŒå…ƒç´ è¢«è§†ä¸ºå®å€¼ã€‚mapä¸å…è®¸ä¸¤ä¸ªå…ƒç´ æ‹¥æœ‰ç›¸åŒçš„é”®å€¼ï¼Œå› æ­¤ï¼Œmapçš„è¿­ä»£å™¨å¯ä»¥ä¿®æ”¹å…ƒç´ çš„å®å€¼ä½†ä¸å¯ä»¥ä¿®æ”¹å…ƒç´ çš„é”®å€¼ã€‚map iteratorsæ—¢ä¸æ˜¯ä¸€ç§constant iteratorsï¼Œä¹Ÿä¸æ˜¯ä¸€ç§mutable iteratorsã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„ï¼Œä»¥ä¸‹Keyä¸ºé”®å€¼(key)å‹åˆ«ï¼ŒTä¸ºå®å€¼(value)å‹åˆ«</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">T</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">Compare</span> = less&lt;Key&gt;,       <span class="comment">//ç¼ºçœé‡‡ç”¨é€’å¢æ’åº</span></span><br><span class="line">		 <span class="keyword">class</span> Alloc = alloc&gt;</span><br><span class="line"><span class="keyword">class</span> map &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">//typedefs:</span></span><br><span class="line">	<span class="keyword">typedef</span> Key key_type;   <span class="comment">//é”®å€¼å‹åˆ«</span></span><br><span class="line">	<span class="keyword">typedef</span> T data_type;    <span class="comment">//æ•°æ®ï¼ˆå®å€¼ï¼‰å‹åˆ«</span></span><br><span class="line">	<span class="keyword">typedef</span> T mapped_type;</span><br><span class="line">	<span class="keyword">typedef</span> pair&lt;<span class="type">const</span> Key, T&gt; value_type;<span class="comment">//å…ƒç´ å‹åˆ«ï¼ˆé”®å€¼/å®å€¼)</span></span><br><span class="line">	<span class="keyword">typedef</span> Compare key_compare; <span class="comment">//é”®å€¼æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">//ä»¥ä¸‹å®šä¹‰ä¸€ä¸ªfunctorï¼Œå…¶ä½œç”¨å°±æ˜¯è°ƒç”¨â€œå…ƒç´ æ¯”è¾ƒå‡½æ•°â€</span></span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">value_compare</span></span><br><span class="line">	: <span class="keyword">public</span> binary_function&lt;value_type, value_type, <span class="type">bool</span>&gt; &#123;</span><br><span class="line">		<span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">map</span>&lt;Key, T, Compare, Alloc&gt;;</span><br><span class="line">		<span class="keyword">protected</span> :</span><br><span class="line">			Compare comp;</span><br><span class="line">			<span class="built_in">value_compare</span>(Compare c) : <span class="built_in">comp</span>(c) &#123;&#125;</span><br><span class="line">		<span class="keyword">public</span> :</span><br><span class="line">			<span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">const</span> value_type&amp; x, <span class="type">const</span> value_type&amp; y)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">comp</span>(x.first, y.first);</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="keyword">typedef</span> rb_tree&lt;key_type, value_type, select1st&lt;value_type&gt;, key_compare, Alloc&gt; rep_type;</span><br><span class="line">		rep_type t;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">		<span class="comment">//æ³¨æ„ä¸‹æ ‡æ“ä½œç¬¦</span></span><br><span class="line">		T&amp; <span class="keyword">operator</span>[](<span class="type">const</span> key_type&amp; k) &#123;</span><br><span class="line">			<span class="keyword">return</span> (*((<span class="built_in">insert</span>(<span class="built_in">value_type</span>(k, <span class="built_in">T</span>()))).first)).second;</span><br><span class="line">		&#125;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="multiset"><a href="#multiset" class="headerlink" title="multiset"></a>multiset</h3><p>multisetå’Œsetçš„å”¯ä¸€å·®åˆ«åœ¨äºå®ƒå…è®¸é”®å€¼é‡å¤ï¼Œå› æ­¤å®ƒçš„æ’å…¥æ“ä½œé‡‡ç”¨çš„æ˜¯åº•å±‚æœºåˆ¶RB-treeçš„insert_equal()è€Œéinsert_unique()ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">Compare</span> = less&lt;Key&gt;, <span class="keyword">class</span> Alloc = alloc&gt;</span><br><span class="line"><span class="keyword">class</span> multiset &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//typedefs:</span></span><br><span class="line">	...(ä¸setç›¸åŒ)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// allocation/deallocation</span></span><br><span class="line">	<span class="comment">//æ³¨æ„, multisetä¸€å®šä½¿ç”¨insert_equal()è€Œä¸ä½¿ç”¨insert_unique()</span></span><br><span class="line">	<span class="comment">//setæ‰ä½¿ç”¨insert_unique()</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">class</span> InputIterator&gt;</span><br><span class="line">	<span class="built_in">multiset</span>(InputIterator first, InputIterator last)</span><br><span class="line">        : <span class="built_in">t</span>(<span class="built_in">Compare</span>()) &#123; t.<span class="built_in">insert_equal</span>(first, last); &#125;</span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">InputIterator</span>&gt;</span><br><span class="line">	<span class="built_in">multiset</span>(InputIterator first, InputIterator last, <span class="type">const</span> Compare&amp; comp)</span><br><span class="line">        : <span class="built_in">t</span>(comp) &#123; t.<span class="built_in">insert_equal</span>(first, last); &#125;</span><br><span class="line">	...(å…¶å®ƒä¸setç›¸åŒ)</span><br><span class="line">        </span><br><span class="line">	<span class="comment">// insert/erase</span></span><br><span class="line">	<span class="function">iterator <span class="title">insert</span><span class="params">(<span class="type">const</span> value_type&amp; x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">insert_equal</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">iterator <span class="title">insert</span><span class="params">(iterator position, <span class="type">const</span> value_type&amp; x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">typedef</span> <span class="keyword">typename</span> rep_type::iterator rep_iterator;</span><br><span class="line">		<span class="keyword">return</span> t.<span class="built_in">insert_equal</span>((rep_iterator&amp;)position,x);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">InputIterator</span>&gt;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(InputIterator first, InputIterator last)</span> </span>&#123;</span><br><span class="line">		t.<span class="built_in">insert_equal</span>(first, last);</span><br><span class="line">	&#125;</span><br><span class="line">	...(å…¶å®ƒä¸setç›¸åŒ)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="multimap"><a href="#multimap" class="headerlink" title="multimap"></a>multimap</h3><p>multimapå’Œmapçš„å”¯ä¸€å·®åˆ«åœ¨äºå®ƒå…è®¸é”®å€¼é‡å¤ï¼Œå› æ­¤å®ƒçš„æ’å…¥æ“ä½œé‡‡ç”¨çš„æ˜¯åº•å±‚æœºåˆ¶RB-treeçš„insert_equal()è€Œéinsert_unique()ã€‚</p>
<h3 id="hashtable"><a href="#hashtable" class="headerlink" title="hashtable"></a>hashtable</h3><p>SGI STLçš„hashtableé‡‡ç”¨çš„å¼€é“¾ï¼ˆseparate chainingï¼‰æ³•æ¥å¤„ç†å†²çªã€‚å› æ­¤ï¼ŒSGIå‘½åç§°hash tableè¡¨æ ¼å†…çš„å…ƒç´ ä¸ºæ¡¶ï¼ˆbucketï¼‰ï¼Œæ­¤åç§°çš„æ„ä¹‰æ˜¯è¡¨æ ¼å†…çš„æ¯ä¸ªå•å…ƒæ¶µç›–çš„ä¸åªæ˜¯ä¸ªèŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ï¼Œç”šè‡³å¯èƒ½æ˜¯ä¸€â€œæ¡¶â€èŠ‚ç‚¹ã€‚</p>
<p><img src="/../img/bucket_hashtable.png" alt="bucket_hashtable"></p>
<p>hash tableçš„èŠ‚ç‚¹å®šä¹‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__hashtable_node</span></span><br><span class="line">&#123;</span><br><span class="line">	__hashtable_node* next;</span><br><span class="line">	Value val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>bucketæ‰€ç»´æŠ¤çš„linked listï¼Œå¹¶ä¸é‡‡ç”¨STLçš„listæˆ–slistï¼Œè€Œæ˜¯è‡ªè¡Œç»´æŠ¤ä¸Šè¿°çš„hash table nodeã€‚è€Œbucketsèšåˆä½“ï¼Œåˆ™ä»¥vectorå®Œæˆä»¥ä¾¿æœ‰åŠ¨æ€æ‰©å……èƒ½åŠ›ã€‚</p>
<h4 id="hashtableçš„è¿­ä»£å™¨"><a href="#hashtableçš„è¿­ä»£å™¨" class="headerlink" title="hashtableçš„è¿­ä»£å™¨"></a>hashtableçš„è¿­ä»£å™¨</h4><p>å®šä¹‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">HashFcn</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">ExtractKey</span>, <span class="keyword">class</span> <span class="title class_">EqualKey</span>, <span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__hashtable_iterator</span> &#123;</span><br><span class="line">	<span class="keyword">typedef</span> hashtable&lt;Value, Key, HashFcn, ExtractKey, EqualKey, Alloc&gt; hashtable;</span><br><span class="line">	<span class="keyword">typedef</span> __hashtable_iterator&lt;value, Key, HashFcn, ExtractKey, EqualKey,  Alloc&gt; iterator;</span><br><span class="line">	<span class="keyword">typedef</span> __hashtable_const_iterator&lt;Value, Key, HashFcn, ExtractKey, EqualKey, Alloc&gt; const_iterator;</span><br><span class="line">	<span class="keyword">typedef</span> __hashtable_node&lt;value&gt; node;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> forward_iterator_tag iterator_category;</span><br><span class="line">	<span class="keyword">typedef</span> Value value_type;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="type">ptrdiff_t</span> difference_type;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="type">size_t</span> size_type;</span><br><span class="line">	<span class="keyword">typedef</span> value&amp; reference;</span><br><span class="line">	<span class="keyword">typedef</span> value* pointer;</span><br><span class="line"></span><br><span class="line">	node* cur;		<span class="comment">//è¿­ä»£å™¨ç›®å‰æ‰€æŒ‡ä¹‹èŠ‚ç‚¹	</span></span><br><span class="line">	hashtable* ht;	<span class="comment">//ä¿æŒå¯¹å®¹å™¨çš„è¿ç»“å…³ç³»(å› ä¸ºå¯èƒ½éœ€è¦ä»bucketè·³åˆ°bucket)</span></span><br><span class="line"></span><br><span class="line">	__hashtable_iterator(node* n, hashtable* tab) : <span class="built_in">cur</span>(n), <span class="built_in">ht</span>(tab) &#123; &#125;</span><br><span class="line">	__hashtable_iterator() &#123; &#125;</span><br><span class="line">	reference <span class="keyword">operator</span>*() <span class="type">const</span> &#123; <span class="keyword">return</span> cur-&gt;val; &#125;</span><br><span class="line">	pointer <span class="keyword">operator</span>-&gt;() <span class="type">const</span> &#123; <span class="keyword">return</span> &amp;(<span class="keyword">operator</span>*()); &#125;</span><br><span class="line">	iterator&amp; <span class="keyword">operator</span>++();</span><br><span class="line">	iterator <span class="keyword">operator</span>++(<span class="type">int</span>);</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> iterator&amp; it) <span class="type">const</span> &#123; <span class="keyword">return</span> cur == it.cur; &#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> iterator&amp; it) <span class="type">const</span> &#123; <span class="keyword">return</span> cur != it.cur; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>hashtableè¿­ä»£å™¨éœ€ç»´ç³»ç€ä¸æ•´ä¸ªâ€œbuckets vectorâ€çš„å…³ç³»ï¼Œå¹¶è®°å½•ç›®å‰æ‰€æŒ‡çš„èŠ‚ç‚¹ã€‚æ˜¯å› ä¸ºå…¶å‰è¿›æ“ä½œä¸­ï¼Œè‹¥ä¸‹ä¸€æ­¥åœ¨åŒä¸€bucketå†…ï¼Œåˆ™åˆ©ç”¨èŠ‚ç‚¹çš„nextæŒ‡é’ˆå®Œæˆæ“ä½œï¼ˆéœ€è¦ç›®å‰èŠ‚ç‚¹ï¼‰ï¼›è‹¥ç›®å‰èŠ‚ç‚¹æ­£å¥½æ˜¯listçš„å°¾ç«¯ï¼Œåˆ™è·³è‡³ä¸‹ä¸€ä¸ªbucketä¸Šï¼ˆéœ€è¦æ•´ä¸ªâ€œbucket vectorâ€ï¼‰ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">ExK</span>, <span class="keyword">class</span> <span class="title class_">EqK</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line">__hashtable_iterator&lt;V, K, HF, EXK, EqK, A&gt;&amp;</span><br><span class="line">__hashtable_iterator&lt;V, K, HF, ExK, EqK, A&gt;::<span class="keyword">operator</span>++()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> node* old = cur;</span><br><span class="line">	cur = cur-&gt;next;      <span class="comment">//å¦‚æœå­˜åœ¨ï¼Œå°±æ˜¯å®ƒã€‚å¦åˆ™è¿›å…¥ä»¥ä¸‹ifæµç¨‹</span></span><br><span class="line">	<span class="keyword">if</span> (!cur) &#123;</span><br><span class="line">		<span class="comment">//æ ¹æ®å…ƒç´ å€¼ï¼Œå®šä½å‡ºä¸‹ä¸€ä¸ªbucketã€‚å…¶èµ·å¤´å¤„å°±æ˜¯æˆ‘ä»¬çš„ç›®çš„åœ°</span></span><br><span class="line">		size_type bucket = ht-&gt;<span class="built_in">bkt_num</span>(old-&gt;val);</span><br><span class="line">		<span class="keyword">while</span> (!cur &amp;&amp; ++bucket &lt; ht-&gt;buckets.<span class="built_in">size</span>()) <span class="comment">//æ³¨æ„ï¼Œoperator++</span></span><br><span class="line">			cur = ht-&gt;buckets[bucket];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">ExK</span>, <span class="keyword">class</span> <span class="title class_">EqK</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line">__hashtable_iterator&lt;V, K, HF, EXK, EqK, A&gt;</span><br><span class="line">__hashtable_iterator&lt;V, K, HF, ExK, EqK, A&gt;::<span class="keyword">operator</span>++(<span class="type">int</span>)</span><br><span class="line">&#123;</span><br><span class="line">	iterator tmp = *<span class="keyword">this</span>;</span><br><span class="line">	++*<span class="keyword">this</span>;   <span class="comment">//è°ƒç”¨operator++()</span></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œhashtableçš„è¿­ä»£å™¨æ²¡æœ‰åé€€æ“ä½œï¼ˆoperatorâ€“()ï¼‰ï¼Œä¹Ÿæ²¡æœ‰å®šä¹‰æ‰€è°“çš„é€†å‘è¿­ä»£å™¨ï¼ˆreverse iteratorï¼‰ã€‚</p>
<h4 id="hashtableçš„æ•°æ®ç»“æ„"><a href="#hashtableçš„æ•°æ®ç»“æ„" class="headerlink" title="hashtableçš„æ•°æ®ç»“æ„"></a>hashtableçš„æ•°æ®ç»“æ„</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">HashFcn</span>,</span><br><span class="line">		 <span class="keyword">class</span> <span class="title class_">ExtractKey</span>, <span class="keyword">class</span> <span class="title class_">EqualKey</span>, <span class="keyword">class</span> <span class="title class_">Allo</span> = alloc&gt;</span><br><span class="line"><span class="keyword">class</span> hashtable;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value</span>, <span class="keyword">class</span> <span class="title class_">Key</span>, <span class="keyword">class</span> <span class="title class_">HashFcn</span>,</span><br><span class="line">		<span class="keyword">class</span> <span class="title class_">ExtractKey</span>, <span class="keyword">class</span> <span class="title class_">EqualKey</span>,</span><br><span class="line">		<span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;    <span class="comment">//å…ˆå‰å£°æ˜æ—¶ï¼Œå·²ç»™äºˆAllocé»˜è®¤å€¼alloc</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hashtable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">typedef</span> HashFcn hasher;</span><br><span class="line">	<span class="keyword">typedef</span> EqualKey key_equal;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="type">size_t</span> size_type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//ä»¥ä¸‹ä¸‰è€…éƒ½æ˜¯function objects.&lt;stl_hash_fun.h&gt;ä¸­å®šä¹‰æœ‰æ•°ä¸ª</span></span><br><span class="line">	<span class="comment">//æ ‡å‡†å‹åˆ«ï¼ˆå¦‚int, c-style stringç­‰ï¼‰çš„hasher</span></span><br><span class="line">	hasher hash;</span><br><span class="line">	key_equal equals;</span><br><span class="line">	ExtractKey get_key;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">typedef</span> __hashtable_node&lt;Value&gt; node;</span><br><span class="line">	<span class="keyword">typedef</span> simple_alloc&lt;node, Alloc&gt; node_allocator;</span><br><span class="line">    </span><br><span class="line">	vector&lt;node*, Alloc&gt; buckets; <span class="comment">//ä»¥vectorå®Œæˆ</span></span><br><span class="line">	size_type num_elements;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//bucketä¸ªæ•°å³buckets vectorçš„å¤§å°</span></span><br><span class="line">	<span class="function">size_type <span class="title">bucket_count</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> buckets.<span class="built_in">size</span>(); &#125;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>hashtableçš„æ¨¡æ¿å‚æ•°çš„æ„ä¹‰ï¼š</p>
<ul>
<li>Value: èŠ‚ç‚¹çš„å®å€¼ç±»å‹ã€‚</li>
<li>Key: èŠ‚ç‚¹çš„é”®å€¼ç±»å‹ã€‚</li>
<li>HashFcn: hash functionçš„å‡½æ•°ç±»å‹ã€‚</li>
<li>ExtractKey: ä»èŠ‚ç‚¹ä¸­å»é™¤é”®å€¼çš„æ–¹æ³•ï¼ˆå‡½æ•°æˆ–ä»¿å‡½æ•°ï¼‰ã€‚</li>
<li>EqualKey: åˆ¤æ–­é”®å€¼ç›¸åŒä¸å¦çš„æ–¹æ³•ï¼ˆå‡½æ•°æˆ–ä»¿å‡½æ•°ï¼‰ã€‚</li>
<li>Alloc: ç©ºé—´é…ç½®å™¨ï¼Œç¼ºçœä½¿ç”¨std::allocã€‚</li>
</ul>
<p>è™½ç„¶å¼€é“¾æ³•å¹¶ä¸è¦æ±‚è¡¨æ ¼å¤§å°å¿…é¡»ä¸ºè´¨æ•°ï¼Œä½†SGI STLä»ç„¶ä¸€ç›´è¾“æ¥è®¾è®¡è¡¨æ ¼å¤§å°ï¼Œå¹¶å…ˆå°†28ä¸ªè´¨æ•°è®¡ç®—å¥½ï¼Œä»¥å¤‡éšæ—¶è®¿é—®ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æŸ¥è¯¢åœ¨è¿™28ä¸ªè´¨æ•°ä¹‹ä¸­ï¼Œâ€œæœ€æ¥è¿‘æŸæ•°å¹¶å¤§äºæŸæ•°â€çš„è´¨æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„:å‡è®¾longè‡³å°‘æœ‰32bits</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> __stl_num_primes = <span class="number">28</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> __stl_prime_list [__stl_num_primes] = </span><br><span class="line">&#123;</span><br><span class="line">	<span class="number">53</span>,		<span class="number">97</span>,		<span class="number">193</span>,	<span class="number">389</span>,	<span class="number">769</span>,	<span class="number">1543</span>,</span><br><span class="line">    <span class="number">3079</span>,	<span class="number">6151</span>,	 <span class="number">12289</span>,	  <span class="number">24593</span>,   <span class="number">49157</span>,   <span class="number">98317</span>,</span><br><span class="line">	<span class="number">196613</span>,	<span class="number">393241</span>,	  <span class="number">786433</span>,   <span class="number">1572869</span>,   <span class="number">3145739</span>,   <span class="number">6291469</span>, 				<span class="number">12582917</span>,	<span class="number">25165843</span>,	<span class="number">50331653</span>, 	<span class="number">100663319</span>, 	<span class="number">201326611</span>, </span><br><span class="line">    <span class="number">402653189</span>,    <span class="number">805306457</span>,   <span class="number">1610612741</span>,   <span class="number">3221225473ul</span>, <span class="number">4294967291ul</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹æ‰¾å‡ºä¸Šè¿°28ä¸ªè´¨æ•°ä¹‹ä¸­ï¼Œæœ€æ¥è¿‘å¹¶å¤§äºnçš„é‚£ä¸ªè´¨æ•°</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">unsigned</span> <span class="type">long</span> __stl_next_prime(<span class="type">unsigned</span> <span class="type">long</span> n)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span>* first = __stl_prime_list;</span><br><span class="line">	<span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span>* last = __stl_prime_list + __stl_num_primes;</span><br><span class="line">	<span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span>* pos = <span class="built_in">lower_bound</span>(first, last, n);</span><br><span class="line">	<span class="comment">//ä»¥ä¸Šï¼Œlower_bound()æ˜¯æ³›å‹ç®—æ³•ï¼Œè§ç¬¬6ç« </span></span><br><span class="line">	<span class="comment">//ä½¿ç”¨lower_bound()ï¼Œåºåˆ—éœ€å…ˆæ’åºã€‚æ²¡é—®é¢˜ï¼Œä¸Šè¿°æ•°ç»„å·²æ’åº</span></span><br><span class="line">	<span class="keyword">return</span> pos == last ? *(last - <span class="number">1</span>) : *pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ€»å…±å¯ä»¥æœ‰å¤šå°‘buckets.ä»¥ä¸‹æ˜¯hast_tableçš„ä¸€ä¸ªmember function</span></span><br><span class="line"><span class="function">size_type <span class="title">max_bucket_count</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> __stl_prime__list[__stl_num_primes - <span class="number">1</span>]; &#125;</span><br><span class="line"><span class="comment">//å…¶å€¼å°†ä¸º4294967291</span></span><br></pre></td></tr></table></figure>

<h4 id="hashtableçš„æ„é€ ä¸å†…å­˜ç®¡ç†"><a href="#hashtableçš„æ„é€ ä¸å†…å­˜ç®¡ç†" class="headerlink" title="hashtableçš„æ„é€ ä¸å†…å­˜ç®¡ç†"></a>hashtableçš„æ„é€ ä¸å†…å­˜ç®¡ç†</h4><p>æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hashtable</span> (size_type n, <span class="type">const</span> HashFcn&amp;	hf, <span class="type">const</span> EqualKey&amp;	 eql)</span><br><span class="line">	: <span class="built_in">hash</span>(hf), <span class="built_in">equals</span>(eql), <span class="built_in">get_key</span>(<span class="built_in">ExtractKey</span>()), <span class="built_in">num_elements</span>(<span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">initialize_buckets</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initialize_buckets</span><span class="params">(size_type n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> size_type n_buckets = <span class="built_in">next_size</span>(n);</span><br><span class="line">	<span class="comment">//ä¸¾ä¾‹:ä¼ äºº 50ï¼Œè¿”å›53ã€‚ä»¥ä¸‹é¦–å…ˆä¿ç•™53ä¸ªå…ƒç´ ç©ºé—´ï¼Œç„¶åå°†å…¶å…¨éƒ¨å¡«0</span></span><br><span class="line">	buckets.<span class="built_in">reserve</span>(n_buckets);</span><br><span class="line">	buckets.<span class="built_in">insert</span>(buckets.<span class="built_in">end</span>(), n_buckets, (node*)<span class="number">0</span>);</span><br><span class="line">	num_elements = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­çš„next_size()è¿”å›æœ€æ¥è¿‘nå¹¶å¤§äºnçš„è´¨æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">size_type <span class="title">next_size</span><span class="params">(size_type n)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> __stl_next_prime(n); &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä¸ºbuckets vectorä¿ç•™ç©ºé—´ï¼Œå¹¶å°†æ‰€æœ‰bucketsåˆå§‹åŒ–ä¸ºnullæŒ‡é’ˆã€‚</p>
<h5 id="insertæ“ä½œä¸è¡¨æ ¼é‡æ•´ï¼ˆresizeï¼‰"><a href="#insertæ“ä½œä¸è¡¨æ ¼é‡æ•´ï¼ˆresizeï¼‰" class="headerlink" title="insertæ“ä½œä¸è¡¨æ ¼é‡æ•´ï¼ˆresizeï¼‰"></a>insertæ“ä½œä¸è¡¨æ ¼é‡æ•´ï¼ˆresizeï¼‰</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ’äººå…ƒç´ ï¼Œä¸å…è®¸é‡å¤</span></span><br><span class="line"><span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert_unique</span><span class="params">(<span class="type">const</span> value_type&amp; obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">resize</span>(num_elements + <span class="number">1</span>);<span class="comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å»ºè¡¨æ ¼ï¼Œå¦‚éœ€è¦å°±æ‰©å……</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">insert_unique_noresize</span>(obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹å‡½æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å»ºè¡¨æ ¼ã€‚å¦‚æœä¸éœ€è¦ï¼Œç«‹åˆ»å›è¿”ã€‚å¦‚æœéœ€è¦ï¼Œå°±åŠ¨æ‰‹â€¦</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">Ex</span>, <span class="keyword">class</span> <span class="title class_">Eq</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line"><span class="type">void</span> hashtable&lt;V, K, HF, Ex, Eq, A&gt;::<span class="built_in">resize</span>(size_type num_elements_hint)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//ä»¥ä¸‹ï¼Œâ€œè¡¨æ ¼é‡å»ºä¸å¦â€çš„åˆ¤æ–­åŸåˆ™é¢‡ä¸ºå¥‡ç‰¹ï¼Œæ˜¯æ‹¿å…ƒç´ ä¸ªæ•°ï¼ˆæŠŠæ–°å¢å…ƒç´ è®¡äººåï¼‰å’Œ</span></span><br><span class="line">	<span class="comment">//bucket vectorçš„å¤§å°æ¥æ¯”ã€‚å¦‚æœå‰è€…å¤§äºåè€…ï¼Œå°±é‡å»ºè¡¨æ ¼</span></span><br><span class="line">	<span class="comment">//ç”±æ­¤å¯åˆ¤çŸ¥ï¼Œæ¯ä¸ªbucket(list)çš„æœ€å¤§å®¹é‡å’Œbuckets vectorçš„å¤§å°ç›¸åŒ</span></span><br><span class="line">	<span class="type">const</span> size_type old_n = buckets.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">if</span> (num_elements_hint &gt; old_n) &#123; <span class="comment">//ç¡®å®šçœŸçš„éœ€è¦é‡æ–°é…ç½®</span></span><br><span class="line">		<span class="type">const</span> size_type n = <span class="built_in">next_size</span>(num_elements_hint);  <span class="comment">//æ‰¾å‡ºä¸‹ä¸€ä¸ªè´¨æ•°</span></span><br><span class="line">		<span class="keyword">if</span> (n &gt; old_n) &#123;</span><br><span class="line">			<span class="function">vector&lt;node*, A&gt; <span class="title">tmp</span><span class="params">(n, (node*)<span class="number">0</span>)</span></span>; <span class="comment">//è®¾ç«‹æ–°çš„buckets</span></span><br><span class="line">			__STL_TRY &#123;</span><br><span class="line">				<span class="comment">//ä»¥ä¸‹å¤„ç†æ¯ä¸€ä¸ªæ—§çš„bucket</span></span><br><span class="line">				<span class="keyword">for</span> (size_type bucket = <span class="number">0</span>; bucket &lt; old_n; ++bucket) &#123;</span><br><span class="line">					node* first = buckets[bucket]; <span class="comment">//æŒ‡å‘èŠ‚ç‚¹æ‰€å¯¹åº”ä¹‹ä¸²è¡Œçš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">					<span class="comment">//ä»¥ä¸‹å¤„ç†æ¯ä¸€ä¸ªæ—§bucketæ‰€å«ï¼ˆä¸²è¡Œï¼‰çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">					<span class="keyword">while</span>(first) &#123;<span class="comment">//ä¸²è¡Œè¿˜æ²¡ç»“æŸæ—¶</span></span><br><span class="line">						<span class="comment">//ä»¥ä¸‹æ‰¾å‡ºèŠ‚ç‚¹è½åœ¨å“ªä¸€ä¸ªæ–°bucketå†…</span></span><br><span class="line">						size_type new_bucket = <span class="built_in">bkt_num</span>(first-&gt;val, n);</span><br><span class="line">						<span class="comment">//ä»¥ä¸‹å››ä¸ªæ“ä½œé¢‡ä¸ºå¾®å¦™</span></span><br><span class="line">						<span class="comment">//(1)ä»¤æ—§bucketæŒ‡å‘å…¶æ‰€å¯¹åº”ä¹‹ä¸²è¡Œçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹(ä»¥ä¾¿è¿­ä»£å¤„ç†)</span></span><br><span class="line">						buckets[bucket] = first-&gt;next;</span><br><span class="line">						<span class="comment">//(2)(3ï¼‰å°†å½“å‰èŠ‚ç‚¹æ’äººåˆ°æ–°bucketå†…ï¼Œæˆä¸ºå…¶å¯¹åº”ä¸²è¡Œçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">						first-&gt;next = tmp[new_bucket];</span><br><span class="line">						tmp[new_bucket] = first;</span><br><span class="line">						<span class="comment">//(4)å›åˆ°æ—§bucketæ‰€æŒ‡çš„å¾…å¤„ç†ä¸²è¡Œï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">						first = buckets[bucket];</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				buckets.<span class="built_in">swap</span>(tmp);<span class="comment">//vector::swapã€‚æ–°æ—§ä¸¤ä¸ªbucketså¯¹è°ƒ</span></span><br><span class="line">				<span class="comment">//æ³¨æ„ï¼Œå¯¹è°ƒä¸¤æ–¹å¦‚æœå¤§å°ä¸åŒï¼Œå¤§çš„ä¼šå˜å°ï¼Œå°çš„ä¼šå˜å¤§</span></span><br><span class="line">				<span class="comment">//ç¦»å¼€æ—¶é‡Šæ”¾local tmpçš„å†…å­˜</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//åœ¨ä¸éœ€é‡å»ºè¡¨æ ¼çš„æƒ…å†µä¸‹æ’äººæ–°èŠ‚ç‚¹ã€‚é”®å€¼ä¸å…è®¸é‡å¤</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">Ex</span>, <span class="keyword">class</span> <span class="title class_">Eq</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line">pair&lt;<span class="keyword">typename</span> hashtable&lt;V, K, HF, Ex, Eq, A&gt;::iterator, <span class="type">bool</span>&gt;</span><br><span class="line">hashtable&lt;V, K, HF, Ex, Eq, A&gt;::<span class="built_in">insert_unique_noresize</span>(<span class="type">const</span> value_type&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> size_type n = <span class="built_in">bkt_num</span>(obj); <span class="comment">//å†³å®šobjåº”ä½äº#n bucket</span></span><br><span class="line">	node* first = buckets[n]; <span class="comment">//ä»¤firstæŒ‡å‘bucketå¯¹åº”ä¹‹ä¸²è¡Œå¤´éƒ¨</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¦‚æœbuckets[n]å·²è¢«å ç”¨ï¼Œæ­¤æ—¶firstå°†ä¸ä¸º0ï¼Œäºæ˜¯è¿›äººä»¥ä¸‹å¾ªç¯ï¼Œ</span></span><br><span class="line">	<span class="comment">//èµ°è¿‡bucketæ‰€å¯¹åº”çš„æ•´ä¸ªé“¾è¡¨</span></span><br><span class="line">	<span class="keyword">for</span> (node* cur = first; cur; cur = cur-&gt;next)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">equals</span>(<span class="built_in">get_key</span>(cur-&gt;val), <span class="built_in">get_key</span>(obj)))</span><br><span class="line">			<span class="comment">//å¦‚æœå‘ç°ä¸é“¾è¡¨ä¸­çš„æŸé”®å€¼ç›¸åŒï¼Œå°±ä¸æ’äººï¼Œç«‹åˆ»è¿”å›</span></span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">pair</span>&lt;iterator, <span class="type">bool</span>&gt; (<span class="built_in">iterator</span>(cur, <span class="keyword">this</span>), <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ç¦»å¼€ä»¥ä¸Šå¾ªç¯ï¼ˆæˆ–æ ¹æœ¬æœªè¿›äººå¾ªç¯ï¼‰æ—¶ï¼Œ first æŒ‡å‘bucketæ‰€æŒ‡é“¾è¡¨çš„å¤´éƒ¨èŠ‚ç‚¹</span></span><br><span class="line">	node* tmp = <span class="built_in">new_node</span>(obj);	<span class="comment">//äº§ç”Ÿæ–°èŠ‚ç‚¹</span></span><br><span class="line">	tmp-&gt;next = first;</span><br><span class="line">	buckets[n] = tmp;		   <span class="comment">//ä»¤æ–°èŠ‚ç‚¹æˆä¸ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">	++num__elements;		   <span class="comment">//èŠ‚ç‚¹ä¸ªæ•°ç´¯åŠ 1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pair</span>&lt;iterator, <span class="type">bool</span>&gt;(<span class="built_in">iterator</span>(tmp, <span class="keyword">this</span>), <span class="literal">true</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>insert_equal()ä¸insert_uniqueçš„å·®åˆ«åœ¨äºå‘ç°keyå€¼ç›¸åŒæ—¶ç«‹é©¬æ’å…¥ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">Ex</span>, <span class="keyword">class</span> <span class="title class_">Eq</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> hashtable&lt;V, K, HF, Ex, Eq, A&gt;::iterator, <span class="type">bool</span></span><br><span class="line">hashtable&lt;V, K, HF, Ex, Eq, A&gt;::<span class="built_in">insert_equal_noresize</span>(<span class="type">const</span> value_type&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">//å¦‚æœbuckets[n]å·²è¢«å ç”¨ï¼Œæ­¤æ—¶firstå°†ä¸ä¸º0ï¼Œäºæ˜¯è¿›äººä»¥ä¸‹å¾ªç¯ï¼Œ</span></span><br><span class="line">	<span class="comment">//èµ°è¿‡bucketæ‰€å¯¹åº”çš„æ•´ä¸ªé“¾è¡¨</span></span><br><span class="line">	<span class="keyword">for</span> (node* cur = first; cur; cur = cur-&gt;next)</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">equals</span>(<span class="built_in">get_key</span>(cur-&gt;val), <span class="built_in">get_key</span>(obj))) &#123;</span><br><span class="line">			node* tmp = <span class="built_in">new_node</span>(obj);	<span class="comment">//äº§ç”Ÿæ–°èŠ‚ç‚¹</span></span><br><span class="line">			tmp-&gt;next = cur-&gt;next;</span><br><span class="line">			cur-&gt;next = tmp;		   <span class="comment">//ä»¤å°†æ–°èŠ‚ç‚¹æ’å…¥äºç›®å‰ä½ç½®</span></span><br><span class="line">			++num__elements;		   <span class="comment">//èŠ‚ç‚¹ä¸ªæ•°ç´¯åŠ 1</span></span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">iterator</span>(tmp, <span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åˆ¤æ–­å…ƒç´ çš„è½è„šå¤„ï¼ˆbkt-numï¼‰"><a href="#åˆ¤æ–­å…ƒç´ çš„è½è„šå¤„ï¼ˆbkt-numï¼‰" class="headerlink" title="åˆ¤æ–­å…ƒç´ çš„è½è„šå¤„ï¼ˆbkt_numï¼‰"></a>åˆ¤æ–­å…ƒç´ çš„è½è„šå¤„ï¼ˆbkt_numï¼‰</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‰ˆæœ¬1:æ¥å—å®å€¼(value)å’Œbucketsä¸ªæ•°</span></span><br><span class="line"><span class="function">size_type <span class="title">bkt_num</span><span class="params">(<span class="type">const</span> value_type&amp; obj, <span class="type">size_t</span> n)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bkt_num_key</span>(<span class="built_in">get_key</span>(obj), n); <span class="comment">//è°ƒç”¨ç‰ˆæœ¬4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç‰ˆæœ¬2:åªæ¥å—å®å€¼(value)</span></span><br><span class="line"><span class="function">size_type <span class="title">bkt_num</span><span class="params">(<span class="type">const</span> value_type&amp; obj)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bkt_num_key</span>(<span class="built_in">get_key</span>(obj));     <span class="comment">//è°ƒç”¨ç‰ˆæœ¬3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç‰ˆæœ¬3:åªæ¥å—é”®å€¼</span></span><br><span class="line"><span class="function">size_type <span class="title">bkt_num_key</span><span class="params">(<span class="type">const</span> key_type&amp; key)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bkt_num_key</span>(key, buckets.<span class="built_in">size</span>());<span class="comment">//è°ƒç”¨ç‰ˆæœ¬4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç‰ˆæœ¬4:æ¥å—é”®å€¼å’Œbucketsä¸ªæ•°</span></span><br><span class="line"><span class="function">size_type <span class="title">bkt_num_key</span><span class="params">(<span class="type">const</span> key_type&amp; key, <span class="type">size_t</span> n)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">hash</span>(key) % n;  <span class="comment">// SGI çš„æ‰€æœ‰å†…å»ºçš„hash( )åˆ—äº5.7.7èŠ‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å¤åˆ¶ï¼ˆcopy-fromï¼‰å’Œæ•´ä½“åˆ é™¤ï¼ˆclearï¼‰"><a href="#å¤åˆ¶ï¼ˆcopy-fromï¼‰å’Œæ•´ä½“åˆ é™¤ï¼ˆclearï¼‰" class="headerlink" title="å¤åˆ¶ï¼ˆcopy_fromï¼‰å’Œæ•´ä½“åˆ é™¤ï¼ˆclearï¼‰"></a>å¤åˆ¶ï¼ˆcopy_fromï¼‰å’Œæ•´ä½“åˆ é™¤ï¼ˆclearï¼‰</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">Ex</span>, <span class="keyword">class</span> <span class="title class_">Eq</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line"><span class="type">void</span> hashtable&lt;V, K, HF, Ex, Eq, A&gt;::<span class="built_in">clear</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//é’ˆå¯¹æ¯ä¸€ä¸ªbucket.</span></span><br><span class="line">	<span class="keyword">for</span> (size_type i = <span class="number">0</span>; i &lt; buckets.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">		node* cur = buckets[i];</span><br><span class="line">		<span class="comment">//å°†bucket listä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤æ‰</span></span><br><span class="line">		<span class="keyword">while</span> (cur != <span class="number">0</span>) &#123;</span><br><span class="line">			node* next = cur-&gt;next;</span><br><span class="line">			<span class="built_in">delete_node</span>(cur);</span><br><span class="line">			cur = next;</span><br><span class="line">		&#125;</span><br><span class="line">		buckets [i] = <span class="number">0</span>;<span class="comment">//ä»¤bucketå†…å®¹ä¸ºnullæŒ‡é’ˆ</span></span><br><span class="line">	&#125;</span><br><span class="line">	num_elements = <span class="number">0</span> ;	<span class="comment">//ä»¤æ€»èŠ‚ç‚¹ä¸ªæ•°ä¸º0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//æ³¨æ„ï¼Œbuckets vectorå¹¶æœªé‡Šæ”¾æ‰ç©ºé—´ï¼Œä»ä¿æœ‰åŸæ¥å¤§å°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">HF</span>, <span class="keyword">class</span> <span class="title class_">Ex</span>, <span class="keyword">class</span> <span class="title class_">Eq</span>, <span class="keyword">class</span> <span class="title class_">A</span>&gt;</span><br><span class="line"><span class="type">void</span> hashtable&lt;V, K, HF, Ex, Eq, A&gt;::<span class="built_in">copy_from</span>(<span class="type">const</span> hashtable&amp; ht)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//å…ˆæ¸…é™¤å·±æ–¹çš„buckets vector.è¿™æ“ä½œæ˜¯è°ƒç”¨vector::clear.é€ æˆæ‰€æœ‰å…ƒç´ ä¸º0</span></span><br><span class="line">	buckets.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="comment">//ä¸ºå·±æ–¹çš„buckets vectorä¿ç•™ç©ºé—´ï¼Œä½¿ä¸å¯¹æ–¹ç›¸åŒ</span></span><br><span class="line">	<span class="comment">//å¦‚æœå·±æ–¹ç©ºé—´å¤§äºå¯¹æ–¹ï¼Œå°±ä¸åŠ¨ï¼Œå¦‚æœå·±æ–¹ç©ºé—´å°äºå¯¹æ–¹ï¼Œå°±ä¼šå¢å¤§</span></span><br><span class="line">	buckets.<span class="built_in">reserve</span>(ht.buckets.<span class="built_in">size</span>());</span><br><span class="line">	<span class="comment">//ä»å·±æ–¹çš„buckets vectorå°¾ç«¯å¼€å§‹ï¼Œæ’äººnä¸ªå…ƒç´ ï¼Œå…¶å€¼ä¸ºnullæŒ‡é’ˆ</span></span><br><span class="line">	<span class="comment">//æ³¨æ„ï¼Œæ­¤æ—¶buckets vectorä¸ºç©ºï¼Œæ‰€ä»¥æ‰€è°“å°¾ç«¯ï¼Œå°±æ˜¯èµ·å¤´å¤„</span></span><br><span class="line">	buckets.<span class="built_in">insert</span>(buckets.<span class="built_in">end</span>(), ht.buckets.<span class="built_in">size</span>(), (node*)<span class="number">0</span>);</span><br><span class="line">	__STL_TRY &#123;</span><br><span class="line">		<span class="comment">//é’ˆå¯¹buckets vector</span></span><br><span class="line">		<span class="keyword">for</span> (size_type i = <span class="number">0</span>; i &lt; ht.buckets.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">			<span class="comment">//å¤åˆ¶vectorçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆæ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘hashtableèŠ‚ç‚¹)</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="type">const</span> node* cur = ht.buckets[i]) &#123;</span><br><span class="line">				node* copy = <span class="built_in">new_node</span>(cur-&gt;val);</span><br><span class="line">				buckets [i] = copy;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//é’ˆå¯¹åŒä¸€ä¸ªbucket listï¼Œå¤åˆ¶æ¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">				<span class="keyword">for</span> (node* next = cur-&gt;next; next; cur = next, next = cur-&gt;next) &#123;</span><br><span class="line">					copy-&gt;next = <span class="built_in">new_node</span>(next-&gt;val);</span><br><span class="line">					copy = copy-&gt;next;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		num_elements = ht.num_elements; <span class="comment">//é‡æ–°ç™»å½•èŠ‚ç‚¹ä¸ªæ•°(hashtable çš„å¤§å°)</span></span><br><span class="line">	&#125;</span><br><span class="line">	__STL_UNWIND(<span class="built_in">clear</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="hash-functions"><a href="#hash-functions" class="headerlink" title="hash functions"></a>hash functions</h4><p>&lt;stl_hash_fun.h&gt;å®šä¹‰æœ‰æ•°ä¸ªç°æˆçš„hash functionsï¼Œå…¨éƒ½æ˜¯ä»¿å‡½æ•°ï¼Œé™¤äº†å¯¹äºå­—ç¬¦å­—ç¬¦ä¸²ï¼ˆconst char*ï¼‰è®¾è®¡äº†ä¸€ä¸ªè½¬æ¢å‡½æ•°å¤–ï¼Œå…¶ä½™charï¼Œshortï¼Œintï¼Œlongæ•´å‹ç±»å‹çš„hash functionså‡ ä¹éƒ½ä»€ä¹ˆéƒ½æ²¡åš ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»¥ä¸‹å®šä¹‰äº&lt;stl_hash_fun.h&gt;</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Key</span>&gt; <span class="keyword">struct</span> <span class="title class_">hash</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">size_t</span> __stl_hash_string (<span class="type">const</span> <span class="type">char</span>* s )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> h = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> ( ; *s; ++s)</span><br><span class="line">		h = <span class="number">5</span>*h + *s;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">size_t</span>(h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹æ‰€æœ‰çš„__STL_TEMPLATE_NULLï¼Œåœ¨&lt;stl_config.h&gt;ä¸­çš†è¢«å®šä¹‰ä¸ºtemplate&lt;&gt;</span></span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">char</span>*&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">const</span> <span class="type">char</span>* s)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> __stl_hash_string(s);&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">const</span> <span class="type">char</span>* s)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> __stl_hash_string(s);&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">char</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">char</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">unsigned</span> <span class="type">char</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">signed</span> <span class="type">char</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">unsigned</span> <span class="type">char</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">short</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">short</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">unsigned</span> <span class="type">short</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">unsigned</span> <span class="type">short</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">long</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">long</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br><span class="line">__STL_TEMPLATE_NULL <span class="keyword">struct</span> <span class="title class_">hash</span>&lt;<span class="type">unsigned</span> <span class="type">long</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">unsigned</span> <span class="type">long</span> x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x;&#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä¸Šè¿°å®šä¹‰è¿‡hash functionçš„ç±»å‹ä¹‹å¤–çš„ç±»å‹ï¼Œä¾‹å¦‚stringï¼Œdoubleï¼Œfloatã€‚æ¬²å¤„ç†è¿™äº›ç±»å‹ï¼Œç”¨æˆ·å¿…é¡»è‡ªè¡Œä¸ºå®ƒä»¬å®šä¹‰hash functionã€‚</p>
<h3 id="hash-setå’Œhash-multiset"><a href="#hash-setå’Œhash-multiset" class="headerlink" title="hash_setå’Œhash_multiset"></a>hash_setå’Œhash_multiset</h3><p>hash_setä¸åŒäºsetçš„åœ°æ–¹æ˜¯hash_setçš„åº•å±‚æœºåˆ¶æ—¶hashtableè€Œsetçš„åº•å±‚æœºåˆ¶æ˜¯RB-treeã€‚å› æ­¤ï¼Œsetçš„å…ƒç´ å…·æœ‰è‡ªåŠ¨æ’åºåŠŸèƒ½è€Œhash_setæ²¡æœ‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨æ–¹å¼å®Œå…¨ç›¸åŒã€‚</p>
<p>è€Œhash_multisetä¸hash_setçš„åŒºåˆ«ä»…åœ¨äºå¯¹ä¸åŒæ’å…¥å‡½æ•°çš„è°ƒç”¨ï¼ˆinsert_equal()å’Œinsert_unique()ï¼‰ã€‚</p>
<h3 id="hash-mapå’Œhash-multimap"><a href="#hash-mapå’Œhash-multimap" class="headerlink" title="hash_mapå’Œhash_multimap"></a>hash_mapå’Œhash_multimap</h3><p>hash_mapä¸åŒäºmapçš„åœ°æ–¹æ˜¯hash_mapçš„åº•å±‚æœºåˆ¶æ—¶hashtableè€Œmapçš„åº•å±‚æœºåˆ¶æ˜¯RB-treeã€‚å› æ­¤ï¼Œmapçš„å…ƒç´ å…·æœ‰è‡ªåŠ¨æ’åºåŠŸèƒ½è€Œhash_mapæ²¡æœ‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨æ–¹å¼å®Œå…¨ç›¸åŒã€‚</p>
<p>è€Œhash_multimapä¸hash_mapçš„åŒºåˆ«ä»…åœ¨äºå¯¹ä¸åŒæ’å…¥å‡½æ•°çš„è°ƒç”¨ï¼ˆinsert_equal()å’Œinsert_unique()ï¼‰ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">lzl121373</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2022/04/02/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%BA%94%E7%AB%A0/">http://example.com/2022/04/02/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%BA%94%E7%AB%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com" target="_blank">ğŸ˜Š</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/STL/">STL</a><a class="post-meta__tags" href="/tags/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/">STLæºç å‰–æ</a><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8/">å®¹å™¨</a><a class="post-meta__tags" href="/tags/%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8/">å…³è”å¼å®¹å™¨</a><a class="post-meta__tags" href="/tags/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/">äºŒå‰æœç´¢æ ‘</a><a class="post-meta__tags" href="/tags/RB-tree/">RB-tree</a><a class="post-meta__tags" href="/tags/set/">set</a><a class="post-meta__tags" href="/tags/map/">map</a><a class="post-meta__tags" href="/tags/multiset/">multiset</a><a class="post-meta__tags" href="/tags/multimap/">multimap</a><a class="post-meta__tags" href="/tags/hashtable/">hashtable</a></div><div class="post_share"><div class="social-share" data-image="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/04/08/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E5%85%AD%E7%AB%A0/"><img class="prev-cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">&lt;STLæºç å‰–æ&gt;ç¬¬å…­ç« â€”â€”ç®—æ³•</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/26/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E5%9B%9B%E7%AB%A0/"><img class="next-cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">&lt;STLæºç å‰–æ&gt;ç¬¬å››ç« â€”â€”åºåˆ—å¼å®¹å™¨</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2022/03/26/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬å››ç« â€”â€”åºåˆ—å¼å®¹å™¨"><img class="cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">&lt;STLæºç å‰–æ&gt;ç¬¬å››ç« â€”â€”åºåˆ—å¼å®¹å™¨</div></div></a></div><div><a href="/2022/03/21/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%B8%80%E4%BA%8C%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬ä¸€äºŒç« â€”â€”allocator"><img class="cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-21</div><div class="title">&lt;STLæºç å‰–æ&gt;ç¬¬ä¸€äºŒç« â€”â€”allocator</div></div></a></div><div><a href="/2022/05/09/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%B8%83%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬ä¸ƒç« â€”â€”ä»¿å‡½æ•°"><img class="cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-09</div><div class="title">&lt;STLæºç å‰–æ&gt;ç¬¬ä¸ƒç« â€”â€”ä»¿å‡½æ•°</div></div></a></div><div><a href="/2022/03/23/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%B8%89%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬ä¸‰ç« â€”â€”è¿­ä»£å™¨"><img class="cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-23</div><div class="title">&lt;STLæºç å‰–æ&gt;ç¬¬ä¸‰ç« â€”â€”è¿­ä»£å™¨</div></div></a></div><div><a href="/2022/04/08/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E5%85%AD%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬å…­ç« â€”â€”ç®—æ³•"><img class="cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-08</div><div class="title">&lt;STLæºç å‰–æ&gt;ç¬¬å…­ç« â€”â€”ç®—æ³•</div></div></a></div><div><a href="/2022/05/09/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E5%85%AB%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬å…«ç« â€”â€”é…æ¥å™¨"><img class="cover" src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-09</div><div class="title">&lt;STLæºç å‰–æ&gt;ç¬¬å…«ç« â€”â€”é…æ¥å™¨</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">lzl121373</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lzl121373" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">å®¹å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">å…³è”å¼å®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%EF%BC%88binary-search-tree%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">äºŒå‰æœç´¢æ ‘ï¼ˆbinary search treeï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%EF%BC%88balanced-binary-search-tree%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆbalanced binary search treeï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AVL-tree"><span class="toc-number">2.3.</span> <span class="toc-text">AVL tree</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%97%8B%E8%BD%AC"><span class="toc-number">2.3.1.</span> <span class="toc-text">å•æ—‹è½¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E6%97%8B%E8%BD%AC"><span class="toc-number">2.3.2.</span> <span class="toc-text">åŒæ—‹è½¬</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RB-tree%EF%BC%88%E7%BA%A2%E9%BB%91%E6%A0%91%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">RB-treeï¼ˆçº¢é»‘æ ‘ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E8%8A%82%E7%82%B9"><span class="toc-number">2.4.1.</span> <span class="toc-text">æ’å…¥èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RB-tree%E8%8A%82%E7%82%B9%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.4.2.</span> <span class="toc-text">RB-treeèŠ‚ç‚¹è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RB-tree%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.4.3.</span> <span class="toc-text">RB-treeçš„è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RB-tree%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.4.</span> <span class="toc-text">RB-treeçš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RB-tree%E7%9A%84%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9C"><span class="toc-number">2.4.5.</span> <span class="toc-text">RB-treeçš„å…ƒç´ æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9Cinsert-equal"><span class="toc-number">2.4.5.1.</span> <span class="toc-text">å…ƒç´ æ’å…¥æ“ä½œinsert_equal()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9Cinsert-unique"><span class="toc-number">2.4.5.2.</span> <span class="toc-text">å…ƒç´ æ’å…¥æ“ä½œinsert_unique()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E6%95%B4RB-tree%EF%BC%88%E6%97%8B%E8%BD%AC%E5%8F%8A%E6%94%B9%E5%8F%98%E9%A2%9C%E8%89%B2%EF%BC%89"><span class="toc-number">2.4.5.3.</span> <span class="toc-text">è°ƒæ•´RB-treeï¼ˆæ—‹è½¬åŠæ”¹å˜é¢œè‰²ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E7%9A%84%E6%90%9C%E5%AF%BB"><span class="toc-number">2.4.5.4.</span> <span class="toc-text">å…ƒç´ çš„æœå¯»</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set"><span class="toc-number">2.5.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map"><span class="toc-number">2.6.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multiset"><span class="toc-number">2.7.</span> <span class="toc-text">multiset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multimap"><span class="toc-number">2.8.</span> <span class="toc-text">multimap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashtable"><span class="toc-number">2.9.</span> <span class="toc-text">hashtable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hashtable%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.9.1.</span> <span class="toc-text">hashtableçš„è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hashtable%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.9.2.</span> <span class="toc-text">hashtableçš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hashtable%E7%9A%84%E6%9E%84%E9%80%A0%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">2.9.3.</span> <span class="toc-text">hashtableçš„æ„é€ ä¸å†…å­˜ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#insert%E6%93%8D%E4%BD%9C%E4%B8%8E%E8%A1%A8%E6%A0%BC%E9%87%8D%E6%95%B4%EF%BC%88resize%EF%BC%89"><span class="toc-number">2.9.3.1.</span> <span class="toc-text">insertæ“ä½œä¸è¡¨æ ¼é‡æ•´ï¼ˆresizeï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%85%83%E7%B4%A0%E7%9A%84%E8%90%BD%E8%84%9A%E5%A4%84%EF%BC%88bkt-num%EF%BC%89"><span class="toc-number">2.9.3.2.</span> <span class="toc-text">åˆ¤æ–­å…ƒç´ çš„è½è„šå¤„ï¼ˆbkt_numï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%EF%BC%88copy-from%EF%BC%89%E5%92%8C%E6%95%B4%E4%BD%93%E5%88%A0%E9%99%A4%EF%BC%88clear%EF%BC%89"><span class="toc-number">2.9.3.3.</span> <span class="toc-text">å¤åˆ¶ï¼ˆcopy_fromï¼‰å’Œæ•´ä½“åˆ é™¤ï¼ˆclearï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hash-functions"><span class="toc-number">2.9.4.</span> <span class="toc-text">hash functions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash-set%E5%92%8Chash-multiset"><span class="toc-number">2.10.</span> <span class="toc-text">hash_setå’Œhash_multiset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash-map%E5%92%8Chash-multimap"><span class="toc-number">2.11.</span> <span class="toc-text">hash_mapå’Œhash_multimap</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/25/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬å››éƒ¨åˆ†"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬å››éƒ¨åˆ†"/></a><div class="content"><a class="title" href="/2022/09/25/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬å››éƒ¨åˆ†">&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬å››éƒ¨åˆ†</a><time datetime="2022-09-24T16:00:00.000Z" title="å‘è¡¨äº 2022-09-25 00:00:00">2022-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/28/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸‰éƒ¨åˆ†"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸‰éƒ¨åˆ†"/></a><div class="content"><a class="title" href="/2022/08/28/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸‰éƒ¨åˆ†">&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸‰éƒ¨åˆ†</a><time datetime="2022-08-27T16:00:00.000Z" title="å‘è¡¨äº 2022-08-28 00:00:00">2022-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/29/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬äºŒéƒ¨åˆ†"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬äºŒéƒ¨åˆ†"/></a><div class="content"><a class="title" href="/2022/05/29/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬äºŒéƒ¨åˆ†">&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬äºŒéƒ¨åˆ†</a><time datetime="2022-05-28T16:00:00.000Z" title="å‘è¡¨äº 2022-05-29 00:00:00">2022-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/13/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸€éƒ¨åˆ†"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸€éƒ¨åˆ†"/></a><div class="content"><a class="title" href="/2022/05/13/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" title="&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸€éƒ¨åˆ†">&lt;Redisè®¾è®¡ä¸å®ç°&gt;ç¬¬ä¸€éƒ¨åˆ†</a><time datetime="2022-05-12T16:00:00.000Z" title="å‘è¡¨äº 2022-05-13 00:00:00">2022-05-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/09/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%B8%83%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬ä¸ƒç« â€”â€”ä»¿å‡½æ•°"><img src="/../img/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="&lt;STLæºç å‰–æ&gt;ç¬¬ä¸ƒç« â€”â€”ä»¿å‡½æ•°"/></a><div class="content"><a class="title" href="/2022/05/09/STL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%AC%AC%E4%B8%83%E7%AB%A0/" title="&lt;STLæºç å‰–æ&gt;ç¬¬ä¸ƒç« â€”â€”ä»¿å‡½æ•°">&lt;STLæºç å‰–æ&gt;ç¬¬ä¸ƒç« â€”â€”ä»¿å‡½æ•°</a><time datetime="2022-05-08T16:00:00.000Z" title="å‘è¡¨äº 2022-05-09 00:00:00">2022-05-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By lzl121373</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>